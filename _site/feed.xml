<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-11-20T10:47:13+01:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Frontend software architect living in Belgium</title><subtitle></subtitle><entry><title type="html">Simple Angular dialogs with the Angular CDK</title><link href="http://localhost:4000/simple-angular-dialogs-with-the-cdk/" rel="alternate" type="text/html" title="Simple Angular dialogs with the Angular CDK" /><published>2022-09-27T00:00:00+02:00</published><updated>2022-09-27T00:00:00+02:00</updated><id>http://localhost:4000/simple-angular-dialogs-with-the-cdk</id><content type="html" xml:base="http://localhost:4000/simple-angular-dialogs-with-the-cdk/"><![CDATA[<h2 id="the-goal-of-this-article">The goal of this <strong>article</strong></h2>

<p>In the article <a href="https://blog.brecht.io/routed-angular-dialogs/">Angular routed dialogs</a> I wrote a while ago, the benefits of having dialogs behind routes are explained.
We can consider dialogs as pages just like we would consider other components that are connected
to routes as pages. In the previous article, we see different approaches to handling dialogs and focus on the benefits of putting dialogs behind routes.</p>

<h3 id="some-context">Some context</h3>

<p>We will continue from the context of the <a href="https://blog.brecht.io/routed-angular-dialogs/">Angular routed dialogs</a> article. We have a <code class="language-plaintext highlighter-rouge">UsersComponent</code> that will display a list of users and a <code class="language-plaintext highlighter-rouge">UsersDetailComponent</code> that will display
the details of that use. When clicking in the list of users on a specific user, we want to open its details. The <code class="language-plaintext highlighter-rouge">UsersDetailComponent</code> uses our custom component called <code class="language-plaintext highlighter-rouge">MyDialogComponent</code> to render the details of a specific user in a nice dialog. We use the same setup as the <a href="https://blog.brecht.io/routed-angular-dialogs/">Angular routed dialogs</a> article so if you didn’t read that one yet, you might want to read that first before reading further.</p>

<p>In this article, we will focus on how we can tackle real dialog functionality with the Angular CDK.</p>

<h2 id="why-the-angular-cdk">Why the Angular CDK?</h2>

<p>The Angular CDK library focuses on “behavior(s)” that web application needs. This library includes accessibility, Coercion, Drag and Drop etc. And a other advantage is that is maintained by the Angular Material team.</p>

<p>The CDK provides us with 2 things that we can use for creating modals:</p>

<ol>
  <li>The <a href="https://material.angular.io/cdk/portal/overview"><strong>portal</strong></a>: a piece of UI that can be dynamically rendered to an open slot on the page.</li>
  <li>The <a href="https://material.angular.io/cdk/overlay/overview"><strong>overlay</strong></a>: to create dialog behavior. It supports position strategies and backdrop behavior and provides some additional basic functionalities to leverage our modal.
Most importantly, it will render a div with a class <code class="language-plaintext highlighter-rouge">cdk-overlay-container</code> at the bottom of the <code class="language-plaintext highlighter-rouge">body</code> element where the dialog
will be rendered in. That way, an overlay is never clipped by an <code class="language-plaintext highlighter-rouge">overflow: hidden</code> parent.</li>
</ol>

<h2 id="getting-started">Getting started</h2>

<p>First of all we need to install the <code class="language-plaintext highlighter-rouge">@angular/cdk</code> package by running:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i @angular/cdk <span class="nt">--save</span>
</code></pre></div></div>

<p>We need the <code class="language-plaintext highlighter-rouge">portal</code> and <code class="language-plaintext highlighter-rouge">overlay</code> so let’s import the <code class="language-plaintext highlighter-rouge">PortalModule</code> and the <code class="language-plaintext highlighter-rouge">OverlayModule</code> into our <code class="language-plaintext highlighter-rouge">AppModule</code>.
If we are using <strong>standalone</strong> components, we should import them in the <code class="language-plaintext highlighter-rouge">imports</code> property of our components.</p>

<p>The overlay needs some CDK prebuilt styles to render, e.g: the backdrop.
In our <code class="language-plaintext highlighter-rouge">styles.css</code> we can import that by adding:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@import</span> <span class="s2">'@angular/cdk/overlay-prebuilt.css'</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="creating-the-dialog-component">Creating the dialog component</h2>

<p>We already have a <code class="language-plaintext highlighter-rouge">my-dialog</code> component when we continue from the previous article.
We consume the dialog like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-dialog&gt;</span>
    <span class="nt">&lt;ng-container</span> <span class="na">my-dialog-header</span><span class="nt">&gt;</span>Here is my header<span class="nt">&lt;/ng-container&gt;</span>
    <span class="nt">&lt;ng-container</span> <span class="na">my-dialog-body</span><span class="nt">&gt;</span>Here is my body<span class="nt">&lt;/ng-container&gt;</span>
<span class="nt">&lt;/my-dialog&gt;</span>
</code></pre></div></div>

<p>Since everything will be rendered in an <strong>overlay-container</strong> we need to disable the encapsulation of the styles.
For that reason, we need to set the encapsulation to <code class="language-plaintext highlighter-rouge">ViewEncapsulation.None</code> (otherwise the css won’t make it into the portal):</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-dialog</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">...</span>
    <span class="na">encapsulation</span><span class="p">:</span> <span class="nx">ViewEncapsulation</span><span class="p">.</span><span class="nx">None</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="the-dialog-component-html">The dialog component html</h3>

<p>The html of the template looks like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ng-template</span> <span class="na">cdkPortal</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dialog"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dialog__header"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ng-content</span> <span class="na">select=</span><span class="s">"[my-dialog-header]"</span><span class="nt">&gt;&lt;/ng-content&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">(click)=</span><span class="s">"closeDialog.emit()"</span><span class="nt">&gt;</span>Close<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dialog__body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ng-content</span> <span class="na">select=</span><span class="s">"[my-dialog-body]"</span><span class="nt">&gt;&lt;/ng-content&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/ng-template&gt;</span>
</code></pre></div></div>

<p>Everything is wrapped in an <code class="language-plaintext highlighter-rouge">ng-template</code> that uses the <code class="language-plaintext highlighter-rouge">cdkPortal</code> directive.
We will use <code class="language-plaintext highlighter-rouge">ViewChild</code> later to reference it in our component class.
For the rest, we see 2 <code class="language-plaintext highlighter-rouge">ng-content</code> slots that are used to project the header and the body.
A close button in the header will call the <code class="language-plaintext highlighter-rouge">closeDialog</code> output from our component class (telling its parent to destroy the component).</p>

<h3 id="the-dialog-component-class">The dialog component class</h3>

<p>The first thing we need to do is create an <code class="language-plaintext highlighter-rouge">overLayRef</code>. We will use the <code class="language-plaintext highlighter-rouge">Overlay</code> from the CDK
to create that <code class="language-plaintext highlighter-rouge">overlayRef</code> by using its <code class="language-plaintext highlighter-rouge">create()</code> function. It takes an <code class="language-plaintext highlighter-rouge">overlayConfig</code> parameter to
configure its position, width, backdrop, etc.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">MyDialogComponent</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">overlayConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OverlayConfig</span><span class="p">({</span>
        <span class="c1">// show backdrop</span>
        <span class="na">hasBackdrop</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="c1">// position the dialog in the center of the page</span>
        <span class="na">positionStrategy</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nb">global</span><span class="p">().</span><span class="nx">centerHorizontally</span><span class="p">().</span><span class="nx">centerVertically</span><span class="p">(),</span>
        <span class="c1">// when in the dialog, block scrolling of the page      </span>
        <span class="na">scrollStrategy</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">scrollStrategies</span><span class="p">.</span><span class="nx">block</span><span class="p">(),</span>
        <span class="na">minWidth</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="k">private</span> <span class="nx">overlayRef</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">overlayConfig</span><span class="p">);</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">overlay</span><span class="p">:</span> <span class="nx">Overlay</span><span class="p">){</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The next thing we need to do is attach the portal to the <code class="language-plaintext highlighter-rouge">overlayRef</code> so we can leverage that portal
to render the contents of it inside the overlay. We have to do that
after the view is initialized, so we will need to handle this in the <code class="language-plaintext highlighter-rouge">ngAfterViewInit</code> lifecycle hook.
We will use <code class="language-plaintext highlighter-rouge">@ViewChild(CdkPortal)</code> to get a handle on the <code class="language-plaintext highlighter-rouge">portal</code> we have defined in our template:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">MyDialogComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">AfterViewInit</span> <span class="p">{</span>
    <span class="c1">// get a grasp on the ng-template with the cdkPortal directive</span>
    <span class="p">@</span><span class="nd">ViewChild</span><span class="p">(</span><span class="nx">CdkPortal</span><span class="p">)</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">portal</span><span class="p">:</span> <span class="nx">CdkPortal</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">overlayConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OverlayConfig</span><span class="p">({...});</span>
    <span class="k">private</span> <span class="nx">overlayRef</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">overlayConfig</span><span class="p">);</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">overlay</span><span class="p">:</span> <span class="nx">Overlay</span><span class="p">){</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="nx">ngAfterViewInit</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="c1">// Wait until the view is initialized to attach the portal to the overlay</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">?.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">portal</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is the only thing we need to do to make this work, but we have forgotten about the destruction of this component.
The component does not have any close functionality as it’s not his responsibility.
The dialog will be closed/destroyed by an <code class="language-plaintext highlighter-rouge">*ngIf</code> or a route change.
However we do need to clean up the <code class="language-plaintext highlighter-rouge">overlayRef</code> by calling its <code class="language-plaintext highlighter-rouge">detach()</code> function and its <code class="language-plaintext highlighter-rouge">dispose()</code>
function. We will do that on the <code class="language-plaintext highlighter-rouge">ngOnDestroy</code> lifecycle hook:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">MyDialogComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">AfterViewInit</span><span class="p">,</span> <span class="nx">OnDestroy</span> <span class="p">{</span>
    <span class="c1">// Tell the parent to destroy the component</span>
    <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">closeDialog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="p">@</span><span class="nd">ViewChild</span><span class="p">(</span><span class="nx">CdkPortal</span><span class="p">)</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">portal</span><span class="p">:</span> <span class="nx">CdkPortal</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">...</span>
    <span class="k">public</span> <span class="nx">ngOnDestroy</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="c1">// parent destroys this component, this component destroys the overlayRef</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">?.</span><span class="nx">detach</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">?.</span><span class="nx">dispose</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We see that we have added a <code class="language-plaintext highlighter-rouge">closeDialog</code> output that will be called from within the template
when the close button is clicked.</p>

<h3 id="closing-on-backdrop-click">Closing on backdrop click</h3>

<p>By clicking the close button in the dialog we can tell our parent to destroy the <code class="language-plaintext highlighter-rouge">MyDialog</code> component.
However, we want to do the same when the user clicks on the backdrop.</p>

<p>It turns out that our <code class="language-plaintext highlighter-rouge">overlayRef</code> has a function called <code class="language-plaintext highlighter-rouge">backdropClick()</code> that will return an observable receiving
events when the user clicks on the backdrop. We could leverage that to close the dialog by emitting on the <code class="language-plaintext highlighter-rouge">closeDialog</code>
EventEmitter. In our constructor we can subscribe to that observable and emit when needed:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">constructor</span><span class="p">(...)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">?.</span><span class="nx">backdropClick</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">closeDialog</span><span class="p">.</span><span class="nx">emit</span><span class="p">();</span>
        <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="conclusion">Conclusion</h3>

<p>Below we see the entire implementation of the <code class="language-plaintext highlighter-rouge">MyDialog</code> component class:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">MyDialogComponent</span> <span class="k">implements</span> <span class="nx">AfterViewInit</span> <span class="p">{</span>
    <span class="c1">// get a grasp on the ng-template with the cdkPortal directive </span>
    <span class="p">@</span><span class="nd">ViewChild</span><span class="p">(</span><span class="nx">CdkPortal</span><span class="p">)</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">portal</span><span class="p">:</span> <span class="nx">CdkPortal</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="c1">// the parent is in charge of destroying this component (usually through ngIf or route change)</span>
    <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">closeDialog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">();</span>
    
    <span class="c1">// the configuration of the overlay</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">overlayConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OverlayConfig</span><span class="p">({</span>
        <span class="na">hasBackdrop</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">positionStrategy</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span>
            <span class="p">.</span><span class="nx">position</span><span class="p">()</span>
            <span class="p">.</span><span class="nb">global</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">centerHorizontally</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">centerVertically</span><span class="p">(),</span>
        <span class="na">scrollStrategy</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">scrollStrategies</span><span class="p">.</span><span class="nx">block</span><span class="p">(),</span>
        <span class="na">minWidth</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="c1">// creating the overlayRef</span>
    <span class="k">private</span> <span class="nx">overlayRef</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">overlayConfig</span><span class="p">);</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">overlay</span><span class="p">:</span> <span class="nx">Overlay</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// telling the parent to destroy the dialog when the user</span>
        <span class="c1">// clicks on the backdrop</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">.</span><span class="nx">backdropClick</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">closeDialog</span><span class="p">.</span><span class="nx">emit</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    
    <span class="c1">// attach the portal to the overlayRef when the view is initialized</span>
    <span class="k">public</span> <span class="nx">ngAfterViewInit</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">?.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">portal</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nx">ngOnDestroy</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="c1">// When the parent destroys this component, this component destroys the overlayRef</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">?.</span><span class="nx">detach</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">overlayRef</span><span class="p">?.</span><span class="nx">dispose</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Thanks for reading this short article! I hope you liked it.</p>

<p>Here you can find the Stackblitz example:</p>

<iframe src="https://stackblitz.com/edit/angular-ivy-ppdmmd" width="100%" height="500px"></iframe>

<h2 id="big-thanks-for-the-reviewers">Big thanks for the reviewers</h2>
<ul>
  <li><a href="https://twiter.com/jefiozie">Jeffrey Bosch</a></li>
  <li><a href="https://twitter.com/geromegrignon">Gerome Grignon</a></li>
  <li><a href="https://twitter.com/Ozcar80923785">Ozcar</a></li>
  <li><a href="https://twitter.com/robinpel">Robin Pellegrims</a></li>
  <li><a href="https://twitter.com/nel81212">Nelson Gutiérrez</a></li>
</ul>]]></content><author><name>brechtbilliet</name></author><summary type="html"><![CDATA[The goal of this article]]></summary></entry><entry><title type="html">Complex Angular forms with validation</title><link href="http://localhost:4000/complex-angular-forms-with-validation/" rel="alternate" type="text/html" title="Complex Angular forms with validation" /><published>2022-09-19T00:00:00+02:00</published><updated>2022-09-19T00:00:00+02:00</updated><id>http://localhost:4000/complex-angular-forms-with-validation</id><content type="html" xml:base="http://localhost:4000/complex-angular-forms-with-validation/"><![CDATA[<p>Sometimes forms in Angular can be a pain, and some of us have been struggling with them since the beta phases of Angular2.
First there was only the template driven forms approach, and then later on the Angular core team
introduced Reactive forms. Both solutions still exist today, but the community sold Reactive forms as a best practice and they basically told
us to stay away from template driven forms.
The reasoning behind this was:</p>
<ul>
  <li>Reactive forms are easier to unit-test.</li>
  <li>Less chance of 2-way databinding on models directly.</li>
  <li>Reactive api’s like <code class="language-plaintext highlighter-rouge">valueChanges</code> and <code class="language-plaintext highlighter-rouge">statusChanges</code> returned observables for us.</li>
  <li>Validation was supposed to be better, but there is some debate around that topic.</li>
</ul>

<p>Even though the reactive forms were recommended they also had some disadvantages:</p>
<ul>
  <li>There was a big pain when it came to type safety but that is something that they “fixed” in version 14 where typed forms were 
introduced.</li>
  <li>There was a lot of redundancy when it came to showing validations, error messages, etc…</li>
  <li>It’s also worth noting that <code class="language-plaintext highlighter-rouge">FormGroup</code> and <code class="language-plaintext highlighter-rouge">FormControl</code> are not immutable, so we can’t use <code class="language-plaintext highlighter-rouge">ChangeDetectionStrategy.OnPush</code> on components
where we pass those formGroups and formControls as <code class="language-plaintext highlighter-rouge">@Input()</code>’s, not without having the occasional manual <code class="language-plaintext highlighter-rouge">markForCheck()</code> statement at least.</li>
</ul>

<p>It makes sense actually, there are a lot of different ways to handle validations, composing forms etc, and the Angular team has provided us with
a solution that can be used in a variety of different approaches. We can make the usage of forms easier, but it’s important that we stay close to the
current api.</p>

<p>A small mention here is that there are a few discussions going on, on whether we should use template driven forms of Reactive forms but let’s
not go into detail. Both approaches have their advantages and disadvantages. For this article we are going to use Reactive typed forms in Angular.</p>

<h2 id="writing-our-own-wrappers-and-abstractions">Writing our own wrappers and abstractions</h2>

<p>When helping out companies, complex forms is a subject that keeps coming back and I generally introduce some custom form components and abstractions.
The goal is to reduce both complexity and redundancy while we still improve consistency.
In this article we will create a set of 4 custom written items that work together to achieve a clean way of handling forms:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;form-wrapper&gt;</code> component: This will hold the native form element and a submitted state.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component: This has a label and takes care of validation error messages.</li>
  <li><code class="language-plaintext highlighter-rouge">[formInput]</code> directive: This is used as glue between the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> and the inputs.</li>
  <li><code class="language-plaintext highlighter-rouge">formInputErrors</code> pipe: This is used to render the errors without to much code.</li>
</ul>

<p>I’m not a huge fan of writing our own <code class="language-plaintext highlighter-rouge">FormBuilderService</code>, nor am I a fan of using a third party lib like <code class="language-plaintext highlighter-rouge">formly</code> that uses huge chunks of
configurations with embedded logic. We want to stay as close as possible to Angular, but we do want to avoid redundancy.</p>

<h3 id="the-form-wrapper-component">The form-wrapper component</h3>

<p>This component is a wrapper for the native <code class="language-plaintext highlighter-rouge">form</code> element. It can hold some styling to enforce consistency within our application,
but it also has a <code class="language-plaintext highlighter-rouge">submitted$</code> BehaviorSubject that we can use to show validation errors only when the form is submitted.
In this case, we don’t want to bug the user with validation messages if the form hasn’t even been submitted yet (unless the control is dirty).
why a BehaviorSubject? A <code class="language-plaintext highlighter-rouge">submitted</code> property that would hold a boolean would not enough, since we need a reference type to consume it in another class.
We could use that BehaviorSubject to assign it to a <code class="language-plaintext highlighter-rouge">submit</code> output.
Other than that, we use content projection to add the actual content of the form and that is basically it:</p>

<p><em>Note: For this article we have chosen to use the <code class="language-plaintext highlighter-rouge">standalone</code> component structure, but it could be written with modules as well.</em></p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">form-wrapper</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommonModule</span><span class="p">,</span> <span class="nx">ReactiveFormsModule</span><span class="p">],</span>
    <span class="na">template</span><span class="p">:</span> <span class="s2">`
        &lt;form (submit)="onSubmit()" [formGroup]="formGroup"&gt;
          &lt;ng-content&gt;&lt;/ng-content&gt;
        &lt;/form&gt;
    `</span><span class="p">,</span>
    <span class="na">standalone</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FormWrapperComponent</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">formGroup</span><span class="p">:</span> <span class="nx">FormGroup</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">submitted$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BehaviorSubject</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="c1">// skip(1): don't emit the initial value</span>
    <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">submit</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">submitted$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span> 
    
    <span class="k">public</span> <span class="nx">onSubmit</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">submitted$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="form-input-wrapper-component">form-input-wrapper component</h3>

<p>The <code class="language-plaintext highlighter-rouge">form-input-wrapper</code> component will remove the most of our redundant code (only 3 lines per input). Think about all the <code class="language-plaintext highlighter-rouge">*ngIf</code> code we have to rewrite for every input. 
What about making sure the label is on top of the input instead of on the left of it. 
The <code class="language-plaintext highlighter-rouge">form-input-wrapper</code> component contains a label, and an element that implements <code class="language-plaintext highlighter-rouge">ControlValueAccessor</code>.</p>

<p>We could consume the component like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form-wrapper</span> <span class="na">[formGroup]=</span><span class="s">"form"</span> <span class="na">(submit)=</span><span class="s">"onSubmit()"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"First name"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">[formControl]=</span><span class="s">"form.controls.firstName"</span>
    <span class="err">&lt;/</span><span class="na">form-input-wrapper</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/form-wrapper&gt;</span>
</code></pre></div></div>

<p>The code of the implementation of the <code class="language-plaintext highlighter-rouge">form-input-wrapper</code> might look like this:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">form-input-wrapper</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">template</span><span class="p">:</span> <span class="s2">`
        &lt;label&gt;&lt;/label&gt;
        &lt;ng-content&gt;&lt;/ng-content&gt;
        &lt;!-- Todo: add validation errors later --&gt;
    `</span><span class="p">,</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommonModule</span><span class="p">],</span>
    <span class="na">standalone</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FormInputWrapperComponent</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">label</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>As we can see, we don’t care about validation error messages yet, that is something we will tackle later.
This component will render a label and project some content.</p>

<h3 id="form-input-directive">form-input directive</h3>

<p>In the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component we need a reference to the form control, because that form control holds the valid state which
is exactly what we need to show in the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component.
We could pass that formControl as an input, but that seems like a lot of work to do that every time (It’s redundant).
We need some way to get access to that control from inside the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component.
We will use <code class="language-plaintext highlighter-rouge">@ContentChildren()</code> for that, but the element can be an <code class="language-plaintext highlighter-rouge">form-input</code> or a <code class="language-plaintext highlighter-rouge">textarea</code> or maybe some custom
form control that implements the <code class="language-plaintext highlighter-rouge">ControlValueAccessor</code> interface. We don’t know which query we should pass in the <code class="language-plaintext highlighter-rouge">@ContentChildren()</code>.
To get access to the element that is projected in the content, we can create an
<code class="language-plaintext highlighter-rouge">[formInput]</code> directive which is applied on every of those elements. Later on we can use <code class="language-plaintext highlighter-rouge">@ContentChildren(FormInputDirective)</code> to get that reference.</p>

<p>The implementation of the <code class="language-plaintext highlighter-rouge">[formInput]</code> directive doesn’t hold logic, like we mentioned before: It’s just the glue that gives access:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Directive</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">[formInput]</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">standalone</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FormInputDirective</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">formControl</span><span class="p">:</span> <span class="nx">FormControl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We have to apply the <code class="language-plaintext highlighter-rouge">[formInput]</code> directive on every input element (or element that implements the <code class="language-plaintext highlighter-rouge">ControlValueAccessor</code> interface) to glue it to
its <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"First name"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span>
        <span class="na">type=</span><span class="s">"text"</span>
        <span class="na">formInput</span>
        <span class="na">[formControl]=</span><span class="s">"form.controls.user.controls.firstName"</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/form-input-wrapper&gt;</span>
</code></pre></div></div>

<p>By using <code class="language-plaintext highlighter-rouge">@ContentChildren(FormInputDirective)</code>, we now can add the <code class="language-plaintext highlighter-rouge">formInputs</code> property to the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component which we will later use to retrieve its validity state from.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">FormInputWrapperComponent</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">label</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">@</span><span class="nd">ContentChildren</span><span class="p">(</span><span class="nx">FormInputDirective</span><span class="p">,</span> <span class="p">{</span> <span class="na">descendants</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="nx">formInputs</span><span class="p">:</span> <span class="nx">QueryList</span><span class="o">&lt;</span><span class="nx">FormInputDirective</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="the-structure">The structure</h2>

<p>A small recap: We have one <code class="language-plaintext highlighter-rouge">&lt;form-wrapper&gt;</code> component which holds the submitted state, and that wraps <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code>’s to reduce redundancy with a <code class="language-plaintext highlighter-rouge">[formInput]</code> directive
that acts as glue. In the code below we show an example where we have a <strong>general</strong> form group, and an <strong>address</strong> form group. This HTML won’t change anymore,
so this is the only code we will have to write when creating forms in the future.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form-wrapper</span> <span class="na">[formGroup]=</span><span class="s">"form"</span> <span class="na">(submit)=</span><span class="s">"onSubmit()"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fieldset&gt;</span>
        <span class="nt">&lt;h3&gt;</span>General<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"First name"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span>
                <span class="na">type=</span><span class="s">"text"</span>
                <span class="na">formInput</span>
                <span class="na">[formControl]=</span><span class="s">"form.controls.user.controls.firstName"</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form-input-wrapper&gt;</span>
        <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"Last name"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span>
                <span class="na">type=</span><span class="s">"text"</span>
                <span class="na">formInput</span>
                <span class="na">[formControl]=</span><span class="s">"form.controls.user.controls.lastName"</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form-input-wrapper&gt;</span>
        <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"Age"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span>
                <span class="na">type=</span><span class="s">"number"</span>
                <span class="na">formInput</span>
                <span class="na">[formControl]=</span><span class="s">"form.controls.user.controls.age"</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form-input-wrapper&gt;</span>
    <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;fieldset&gt;</span>
        <span class="nt">&lt;h3&gt;</span>Address<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"Street"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span>
                <span class="na">type=</span><span class="s">"text"</span>
                <span class="na">formInput</span>
                <span class="na">[formControl]=</span><span class="s">"form.controls.address.controls.street"</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form-input-wrapper&gt;</span>
        <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"Street number"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span>
                <span class="na">type=</span><span class="s">"text"</span>
                <span class="na">formInput</span>
                <span class="na">[formControl]=</span><span class="s">"form.controls.address.controls.streetNumber"</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form-input-wrapper&gt;</span>
        <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"City"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span>
                <span class="na">type=</span><span class="s">"text"</span>
                <span class="na">formInput</span>
                <span class="na">[formControl]=</span><span class="s">"form.controls.address.controls.city"</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form-input-wrapper&gt;</span>
        <span class="nt">&lt;form-input-wrapper</span> <span class="na">label=</span><span class="s">"Zipcode"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span>
                <span class="na">type=</span><span class="s">"text"</span>
                <span class="na">formInput</span>
                <span class="na">[formControl]=</span><span class="s">"form.controls.address.controls.zipCode"</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form-input-wrapper&gt;</span>
    <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form-wrapper&gt;</span>

</code></pre></div></div>
<p>Typed forms need types. We can create types but we will use classes instead because later on we will leverage decorators to add validation on them.
We will create the 2 classes <code class="language-plaintext highlighter-rouge">UserForm</code> and <code class="language-plaintext highlighter-rouge">AddressForm</code>, and we use the <code class="language-plaintext highlighter-rouge">FormBuilder</code> api to compose our form:</p>

<p><em>Note: Making these properties <strong>readonly</strong> enforces us to work in an immutable way</em></p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">UserForm</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">firstName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">lastName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">age</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">AddressForm</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">street</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">streetNumber</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">city</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">zipCode</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="p">...</span>
    <span class="na">templateUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./app.component.html</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">FormWrapperComponent</span><span class="p">,</span> <span class="nx">FormInputWrapperComponent</span><span class="p">,</span> <span class="nx">FormInputDirective</span><span class="p">,</span> <span class="nx">ReactiveFormsModule</span><span class="p">,</span> <span class="nx">FormsModule</span><span class="p">,</span> <span class="nx">CommonModule</span><span class="p">],</span>
    <span class="na">standalone</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppComponent</span>  <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">addressForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="o">&lt;</span><span class="nx">AddressForm</span><span class="o">&gt;</span><span class="p">({</span>
        <span class="na">street</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">streetNumber</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">city</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">zipCode</span><span class="p">:</span> <span class="dl">''</span>
    <span class="p">});</span>
    
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">userForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="o">&lt;</span><span class="nx">UserForm</span><span class="o">&gt;</span><span class="p">({</span>
        <span class="na">firstName</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">lastName</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">age</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">});</span>
    
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">form</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
        <span class="na">user</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">userForm</span><span class="p">,</span>
        <span class="na">address</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">addressForm</span>
    <span class="p">})</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">fb</span><span class="p">:</span> <span class="nx">FormBuilder</span><span class="p">){</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="nx">onSubmit</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="validation">Validation</h2>

<p>To have readable consistent validation, let’s use <a href="https://github.com/typestack/class-validator">class-validator</a>. 
We can use it on the frontend, on the backend and it’s
possible to write our own validators. Since class-validator provides us with decorators it’s possible to put them on our forms.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">IsNotEmpty</span><span class="p">,</span> <span class="nx">Min</span><span class="p">,</span> <span class="nx">Max</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">class-validator</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserForm</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">firstName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">lastName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">Min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">Max</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">age</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">AddressForm</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">street</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">streetNumber</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">city</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">zipCode</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>The next thing we need to do is translate these classes into lists of async validators and apply them on our <code class="language-plaintext highlighter-rouge">userForm</code> and <code class="language-plaintext highlighter-rouge">addressForm</code>.
Why async validators? Because <code class="language-plaintext highlighter-rouge">class-validator</code> returns promises when it validates.
Let’s create a shared function called <code class="language-plaintext highlighter-rouge">addAsyncValidators()</code> that will add validators to our form groups.
In the first argument we pass the form group and in the next one the type of its form class (The one with the validation decorators).</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">readonly</span> <span class="nx">addressForm</span> <span class="o">=</span> <span class="nx">addAsyncValidators</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="o">&lt;</span><span class="nx">AddressForm</span><span class="o">&gt;</span><span class="p">({</span>
    <span class="na">street</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="na">streetNumber</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="na">city</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="na">zipCode</span><span class="p">:</span> <span class="dl">''</span>
<span class="p">}),</span> <span class="nx">AddressForm</span><span class="p">);</span> 

<span class="k">private</span> <span class="k">readonly</span> <span class="nx">userForm</span> <span class="o">=</span> <span class="nx">addAsyncValidators</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="o">&lt;</span><span class="nx">UserForm</span><span class="o">&gt;</span><span class="p">({</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="na">age</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}),</span> <span class="nx">UserForm</span><span class="p">);</span> 

<span class="k">public</span> <span class="k">readonly</span> <span class="nx">form</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
    <span class="na">user</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">userForm</span><span class="p">,</span>
    <span class="na">address</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">addressForm</span>
<span class="p">})</span>
</code></pre></div></div>

<p>There is a reason why we compose our form like this. Our form classes will never have nested properties. Each nested property would be a form group, and would 
use the <code class="language-plaintext highlighter-rouge">addAsyncValidators()</code> function. That way we can keep it simple and still use the regular angular FormBuilder api.</p>

<p>The <code class="language-plaintext highlighter-rouge">addAsyncValidators()</code> function would loop over the form and would add the correct validators based on the class
that leverage the decorators. I’m not going to go into detail regarding the following implementation. It is not the goal
 of this article and it’s already long enough. Just know that we only need to write this once and put this in a shared lib.
You can just copy paste it, or improve it and let me know! In a nutshell: We loop over the form object, look up the keys in our class with decorators,
translate the decorators into async validators and create a new form group with those validators attached to it.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// form-utils.ts</span>
<span class="k">import</span> <span class="p">{</span>
    <span class="nx">AbstractControl</span><span class="p">,</span>
    <span class="nx">AsyncValidatorFn</span><span class="p">,</span>
    <span class="nx">FormControl</span><span class="p">,</span>
    <span class="nx">FormGroup</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/forms</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">validate</span><span class="p">,</span> <span class="nx">ValidationError</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">class-validator</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">addAsyncValidators</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">FormGroup</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nx">form</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span>
    <span class="nx">formType</span><span class="p">:</span> <span class="k">new</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">any</span>
<span class="p">):</span> <span class="nx">T</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">groupObj</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">controls</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span>
        <span class="p">(</span><span class="nx">obj</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">key</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]:</span> <span class="nx">FormControl</span> <span class="p">},</span> <span class="nx">key</span><span class="p">:</span> <span class="kr">keyof</span> <span class="nx">T</span> <span class="o">&amp;</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">validators</span> <span class="o">=</span> <span class="p">[</span><span class="nx">createValidatorFn</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">formType</span><span class="p">)];</span>
            <span class="kd">const</span> <span class="nx">formControl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormControl</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="p">{</span>
                <span class="na">asyncValidators</span><span class="p">:</span> <span class="nx">validators</span><span class="p">,</span>
            <span class="p">});</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">obj</span><span class="p">,</span>
                <span class="p">[</span><span class="nx">key</span><span class="p">]:</span> <span class="nx">formControl</span><span class="p">,</span>
            <span class="p">};</span>
        <span class="p">},</span>
        <span class="p">{}</span> <span class="k">as</span> <span class="p">{</span> <span class="p">[</span><span class="nx">key</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]:</span> <span class="nx">FormControl</span> <span class="p">}</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">FormGroup</span><span class="p">(</span><span class="nx">groupObj</span> <span class="k">as</span> <span class="p">{</span> <span class="p">[</span><span class="nx">key</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]:</span> <span class="nx">FormControl</span> <span class="p">})</span> <span class="k">as</span> <span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">createValidatorFn</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">formType</span><span class="p">:</span> <span class="k">new</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="kr">any</span>
<span class="p">):</span> <span class="nx">AsyncValidatorFn</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">control</span><span class="p">:</span> <span class="nx">AbstractControl</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">toValidate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">formType</span><span class="p">();</span>
        <span class="nx">toValidate</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">control</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">validate</span><span class="p">(</span><span class="nx">toValidate</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="na">validationErrors</span><span class="p">:</span> <span class="nx">ValidationError</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">err</span> <span class="o">=</span> <span class="nx">validationErrors</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
                <span class="p">(</span><span class="na">v</span><span class="p">:</span> <span class="nx">ValidationError</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">?.</span><span class="nx">property</span> <span class="o">===</span> <span class="nx">key</span>
            <span class="p">);</span>
            
            <span class="k">return</span> <span class="nx">err</span> 
            <span class="p">?</span> <span class="p">({</span>
                <span class="na">constraints</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">constraints</span><span class="p">,</span>
                <span class="na">contexts</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">contexts</span><span class="p">,</span>
            <span class="p">}</span> <span class="k">as</span> <span class="nx">ValidationError</span><span class="p">)</span>
            <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">};</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="showing-the-validations">Showing the validations</h3>

<p>To show the validators we need to use the <code class="language-plaintext highlighter-rouge">formInputs</code> property of the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component.
The errors that we want to show live in <code class="language-plaintext highlighter-rouge">formInputs?.first?.formControl?.errors</code>.
The validation errors that <code class="language-plaintext highlighter-rouge">class-validator</code> spits out have a very specific format: 
<code class="language-plaintext highlighter-rouge">constraints[keyname]</code> holds the validation message. We know multiple validation messages for one
form input is possible so let’s write a pipe to loop over that data and return the list.
Let’s create a <code class="language-plaintext highlighter-rouge">formInputErrors</code> pipe that checks if there are constraints, and if there are any, it returns a nice list
of these validation errors:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Pipe</span><span class="p">,</span> <span class="nx">PipeTransform</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ValidationErrors</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/forms</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Pipe</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">formInputErrors</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">standalone</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FormInputErrorsPipe</span> <span class="k">implements</span> <span class="nx">PipeTransform</span> <span class="p">{</span>
    <span class="nx">transform</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">ValidationErrors</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">args</span><span class="p">?:</span> <span class="kr">any</span><span class="p">):</span> <span class="kr">any</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">value</span><span class="p">?.</span><span class="nx">constraints</span><span class="p">){</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">value</span><span class="p">?.</span><span class="nx">constraints</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">key</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">value</span><span class="p">?.</span><span class="nx">constraints</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To use this pipe we add an <code class="language-plaintext highlighter-rouge">*ngFor</code> statement in the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component.
Because we are working with standalone components, don’t forget to add the <code class="language-plaintext highlighter-rouge">FormInputErrorsPipe</code> into the imports of that component:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">CommonModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">ContentChildren</span><span class="p">,</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">QueryList</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">FormInputErrorsPipe</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../form-input-errors.pipe</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">FormInputDirective</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../form-input.directive</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">form-input-wrapper</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">template</span><span class="p">:</span> <span class="s2">`
        &lt;label&gt;&lt;/label&gt; &lt;ng-content&gt;&lt;/ng-content&gt;
        &lt;ul&gt;
          &lt;li *ngFor="let child of formInputs?.first?.formControl?.errors|formInputErrors"&gt;&lt;/li&gt;
        &lt;/ul&gt;
    `</span><span class="p">,</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommonModule</span><span class="p">,</span> <span class="nx">FormInputDirective</span><span class="p">,</span> <span class="nx">FormInputErrorsPipe</span><span class="p">],</span>
    <span class="na">standalone</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FormInputWrapperComponent</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">label</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="c1">// search for elements of type FormInputDirective in the &lt;ng-content&gt;</span>
    <span class="p">@</span><span class="nd">ContentChildren</span><span class="p">(</span><span class="nx">FormInputDirective</span><span class="p">,</span> <span class="p">{</span> <span class="na">descendants</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">formInputs</span><span class="p">:</span> <span class="nx">QueryList</span><span class="o">&lt;</span><span class="nx">FormInputDirective</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="adding-a-validation-class-on-the-forminput-directive">Adding a validation class on the <code class="language-plaintext highlighter-rouge">formInput</code> directive</h3>

<p>Sometimes we want to have a red border our another specific style on invalid fields.
Let’s add a css class called <code class="language-plaintext highlighter-rouge">form-input--invalid</code> when the form input contains errors.
We can do that by using a <code class="language-plaintext highlighter-rouge">@HostBinding()</code>, injecting the <code class="language-plaintext highlighter-rouge">FormWrapperComponent</code> and using the form control that we pass
through an <code class="language-plaintext highlighter-rouge">@Input()</code> property.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">FormInputDirective</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">submitted$</span> <span class="o">=</span> <span class="nx">inject</span><span class="p">(</span><span class="nx">FormWrapperComponent</span><span class="p">).</span><span class="nx">submitted$</span><span class="p">;</span> <span class="c1">// a value type wouldn't be sufficient here</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">formControl</span><span class="p">:</span> <span class="nx">FormControl</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">HostBinding</span><span class="p">(</span><span class="dl">'</span><span class="s1">class.form-input--invalid</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">public</span> <span class="kd">get</span> <span class="nx">invalid</span><span class="p">():</span> <span class="nx">boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">formControl</span><span class="p">?.</span><span class="nx">invalid</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">formControl</span><span class="p">?.</span><span class="nx">touched</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">submitted$</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This will set the <code class="language-plaintext highlighter-rouge">form-input--invalid</code> class every time the control is invalid, and it has been touched or the form is submitted.</p>

<h3 id="conditionally-showing-the-validations-with-dependency-injection">Conditionally showing the validations with dependency injection</h3>

<p>Now the validations are shown, we only want to show them when the form is submitted or when the form control is touched.
For that we can inject the <code class="language-plaintext highlighter-rouge">FormWrapperComponent</code> into the <code class="language-plaintext highlighter-rouge">&lt;form-input-wrapper&gt;</code> component and add an 
<code class="language-plaintext highlighter-rouge">*ngIf</code> statement on the <code class="language-plaintext highlighter-rouge">&lt;ul&gt;</code> element that checks if the form is submitted, or the form control is dirty.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">form-input-wrapper</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">CommonModule</span><span class="p">,</span>
        <span class="nx">FormInputDirective</span><span class="p">,</span>
        <span class="nx">FormInputErrorsPipe</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="na">standalone</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">template</span><span class="p">:</span> <span class="s2">`
    &lt;label&gt;&lt;/label&gt; &lt;ng-content&gt;&lt;/ng-content&gt;
    &lt;ul *ngIf="(submitted$|async)|| 
        (formInputs?.first?.formControl.touched &amp;&amp; formInputs?.first?.formControl?.errors)"&gt;
        &lt;li *ngFor="let child of formInputs?.first?.formControl?.errors|formInputErrors"&gt;&lt;/li&gt;
    &lt;/ul&gt;
`</span><span class="p">,</span>

<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FormInputWrapperComponent</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="k">public</span> <span class="k">readonly</span> <span class="nx">label</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">@</span><span class="nd">ContentChildren</span><span class="p">(</span><span class="nx">FormInputDirective</span><span class="p">,</span> <span class="p">{</span> <span class="na">descendants</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">formInputs</span><span class="p">:</span> <span class="nx">QueryList</span><span class="o">&lt;</span><span class="nx">FormInputDirective</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">submitted$</span> <span class="o">=</span> <span class="nx">inject</span><span class="p">(</span><span class="nx">FormWrapperComponent</span><span class="p">).</span><span class="nx">submitted$</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="custom-validator">Custom validator</h3>

<p>Creating a custom validator for <code class="language-plaintext highlighter-rouge">class-validator</code> is not that hard. 
Let’s create a <code class="language-plaintext highlighter-rouge">noSpecialChars</code> validator that will throw an error when the user
types a special character in one of the name fields.
The usage of our validator looks like this:</p>

<p>We will use our decorator like this:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">noSpecialChars</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">[\!\@\#\$\%\^\&amp;\*\)\(\+\=\.\&lt;\&gt;\{\}\[\]\:\;\'\"\|\~\`\_]</span><span class="sr">/g</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">regex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserForm</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">CustomValidator</span><span class="p">(</span><span class="nx">noSpecialChars</span><span class="p">,</span> <span class="p">{</span><span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">First name can not contain special chars</span><span class="dl">'</span><span class="p">})</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">firstName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">CustomValidator</span><span class="p">(</span><span class="nx">noSpecialChars</span><span class="p">,</span> <span class="p">{</span><span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Last name can not contain special chars</span><span class="dl">'</span><span class="p">})</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">lastName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">Min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">Max</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="nx">age</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We have written a <code class="language-plaintext highlighter-rouge">@CustomValidator()</code> because it’s convenient to a pass validation function in that.
The implementation of the <code class="language-plaintext highlighter-rouge">@CustomValidator()</code> looks like the code sample below. For more information on this, I would
advice to consult <a href="https://github.com/typestack/class-validator#custom-validation-decorators">the docs</a></p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span>
    <span class="nx">registerDecorator</span><span class="p">,</span>
    <span class="nx">ValidationArguments</span><span class="p">,</span>
    <span class="nx">ValidationOptions</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">class-validator</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">CustomValidator</span><span class="p">(</span><span class="nx">validatorFn</span><span class="p">:</span> <span class="nb">Function</span><span class="p">,</span> <span class="nx">options</span><span class="p">?</span> <span class="p">:</span> <span class="nx">ValidationOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">propertyName</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">registerDecorator</span><span class="p">({</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">target</span><span class="p">:</span> <span class="nx">object</span><span class="p">.</span><span class="kd">constructor</span><span class="p">,</span>
            <span class="na">propertyName</span><span class="p">:</span> <span class="nx">propertyName</span><span class="p">,</span>
            <span class="na">options</span><span class="p">:</span> <span class="nx">options</span><span class="p">,</span>
            <span class="na">constraints</span><span class="p">:</span> <span class="p">[],</span>
            <span class="na">validator</span><span class="p">:</span> <span class="p">{</span>
                <span class="nx">validate</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="na">args</span><span class="p">:</span> <span class="nx">ValidationArguments</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">validatorFn</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">};</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>That’s it folks! We have written some custom logic in order to write less form code in the future.</p>
<ul>
  <li>We have less HTML that we need to write in the future</li>
  <li>We have a consistent way of placing the input and label</li>
  <li>We have a consistent way of showing validation errors and when to show them (if submitted or dirty)</li>
  <li>We have clean form classes that we decorate with validators</li>
  <li>We can write custom decorators and pass them to the <code class="language-plaintext highlighter-rouge">CustomValidator()</code> decorator.</li>
</ul>

<p>Here you can check out the Stackblitz example:</p>

<iframe src="https://stackblitz.com/edit/angular-ivy-ri8j21" width="100%" height="500px"></iframe>

<p><strong>A big thanks to the reviewers!!</strong></p>
<ul>
  <li><a href="https://twitter.com/aaron_delange">Aaron Delange</a></li>
  <li><a href="https://twitter.com/niklas_wortmann">Jan-Niklas wortmann</a></li>
  <li><a href="https://twitter.com/webdave_de">Webdave</a></li>
</ul>]]></content><author><name>brechtbilliet</name></author><summary type="html"><![CDATA[Sometimes forms in Angular can be a pain, and some of us have been struggling with them since the beta phases of Angular2. First there was only the template driven forms approach, and then later on the Angular core team introduced Reactive forms. Both solutions still exist today, but the community sold Reactive forms as a best practice and they basically told us to stay away from template driven forms. The reasoning behind this was: Reactive forms are easier to unit-test. Less chance of 2-way databinding on models directly. Reactive api’s like valueChanges and statusChanges returned observables for us. Validation was supposed to be better, but there is some debate around that topic.]]></summary></entry><entry><title type="html">Breaking out of the comfort zone</title><link href="http://localhost:4000/breaking-out-of-the-comfort-zone/" rel="alternate" type="text/html" title="Breaking out of the comfort zone" /><published>2022-09-09T00:00:00+02:00</published><updated>2022-09-09T00:00:00+02:00</updated><id>http://localhost:4000/breaking-out-of-the-comfort-zone</id><content type="html" xml:base="http://localhost:4000/breaking-out-of-the-comfort-zone/"><![CDATA[<p>The people that are used to read my articles will quickly realise that this is not the type of articles I generally write.
Since I’m passionate about this subject, I’m going to write about it anyway. Bear with me, you might take away
something from it. If not, at least you gave it a shot, right? I’m writing a book as we speak about my life and career as
a software professional, not sure if I’ll ever publish it, but consider this a very slimmed down version of some chapters of that book.</p>

<p>This article is about personal experiences in my life and career and can be bare, how I struggled with life and how I managed to break free. 
The reason I’m writing about this is that I think it might help people, sometimes the answer to a happy and fulfilling life is right in front of us.</p>

<p>The people that know me, or at least followed me in the last 7 years, might have experienced a form of silence of me in the last years.
I used to blog more actively, used to be at conferences and in the frontend community my name was mentioned from time to time. 
That stopped for a while, and I’ll tell you why later. First let’s go back to the start.</p>

<h3 id="the-beginning-of-my-career">The beginning of my career</h3>

<p>In 2010 my boss called me over to his office and told me my work sucked! Although he wasn’t able to tell me why nor what I did wrong, 
he seemed to really enjoy telling me that. To give you some context, I was a junior engineer (just left school), and I was the only one doing web development at that company. 
I did Ruby, PHP, java, C++, C, VB.NET, javascript, photoshop and a bunch of other things. 
The thing is I was working alone, with no guidance, no mentoring, no coaching. 
Apparently a customer told my boss there was a bug in my code, and he told him he was going to talk to me, so it wouldn’t happen again.
When he told me my work sucked, and he couldn’t even tell me why I decided that was not a company I wanted to work for and I quit my job on the spot.</p>

<p>This was one of my first encounters with <strong>Breaking out of the comfort zone</strong>. I felt like crap, and I had no idea what I needed to do, but for some reason this brought me luck.
It felt good and bad at the same time. I needed to find a job because I needed to pay my rent so there was a level of motivation I didn’t knew before.
By luck, I met interesting people that convinced me to do consultancy, and a few months later I was a .NET consultant working for a Belgian railways company.
Yes… I had to learn day and night to get to know the technology, but it gave me a certain drive and working day and night actually gave me more energy than
it cost me.</p>

<p>2 years later there was a small voice telling me it was better to fail trying then to get rusty, so I decided to become self-employed.
Since then every move I made in my career made me feel very uncomfortable in the beginning, but then turned out to pay off every time!
I’m not going to go into every time I broke out of my comfort zone, I’m writing my book for that. But this article is to wake people up.
Getting out of your comfort zone, will open up doors you wouldn’t expect to. <strong>The more you get out of your comfort zone, the luckier you’ll get</strong>.</p>

<p>7 years ago A colleague of mine called <a href="https://twitter.com/Sh33dafi">Yannick Houbrix</a> asked me to give a talk for the company he worked for. 
He said it was only for a group of 10 people, and that it was just knowledge sharing. I was scared at first, but since there were only
 10 people in front of me I decided to do it. I created a talk about Angular.js components and unidirectional dataflows and I was ready to impress a dozen of people.</p>

<p>It felt uncomfortable in the beginning, and I even felt more uncomfortable when those 10 people turned out to be 100 people (Thanks Yannick! I didn’t get the memo… ;-)). 
Anyways, I was already there on stage and the talk went quite nice. <strong>Breaking out of that comfort zone</strong> resulted in a Belgian publishing company asking me to perform my first 3 day audit for their
angular.js code. The more I broke out of that comfort zone, the luckier i got. Opportunities started to present themselves.</p>

<h3 id="becoming-an-international-angular-trainerconsultant">Becoming an international Angular trainer/consultant</h3>

<p>A few weeks later Yannick’s company asked me to do a training in Angular2 (which was the successor of angular.js at the time).
I decided to jump on the occasion and give my first Angular workshop, I already had experience in doing that in angular.js at the time.
Giving that training wasn’t uncomfortable but organising a 2-day public workshop in a venue in Ghent weeks later certainly was…
 What if I wasn’t going to sell those workshops? I would totally fail then, right?! It wasn’t cheap to rent the venue, and I would have had to admit my failure.</p>

<p>I had listened to a talk of <a href="https://www.twitter.com/toddmotto">Todd Motto</a> a few weeks before that, where he explained <strong>nothing was ever achieved in the comfort zone</strong> and I decided to 
follow my gut and give my own public Angular workshop. 
Even though people told me I couldn’t, I didn’t just sold one but I sold three public 2-day workshops that month for 8 people per session.
At the same time there was a famous German Angular training company giving a workshop (also in Ghent), but I listened to my gut and pulled myself out of comfort.</p>

<p>Small sidetrack: Less than a year later that same company asked me to freelance for them and we had an awesome collaboration doing international Angular trainings.</p>

<p>In one of the workshops I hosted in Ghent, I invited <a href="https://www.twitter.com/jvandemo">Jurgen Van de Moere</a> who later turned out to be <a href="https://ng-be.org/">ng-be</a> co-organiser 
together with <a href="https://twitter.com/samvloeberghs">Sam vloeberghs</a>.</p>

<p>Even though I didn’t knew Jurgen was co-organiser of ng-be, I invited him to my workshop for free because I thought he was an interesting guy (and he is) and since he liked it
he asked me to give a training at ng-be. Getting out of my comfort zone brought me an opportunity that put me on the map in the Angular community.
Was it luck? It certainly was partially, but when you stay comfortable, and you are not willing to put yourself out there, it might be very hard for luck to find you.</p>

<p>Years went by, I started a company together with <a href="https://www.twitter.com/kwintenp">Kwinten Pisman</a> called <a href="https://strongbrew.io">StrongBrew</a> 
and we became international trainers/consultants with focus on Angular and RxJS.</p>

<h3 id="getting-back-into-my-comfort-zone">Getting back into my comfort zone</h3>

<p>First of all, getting out of that comfort zone, and making big jumps in your career has some consequences. It’s not all fun and giggles.
There is this thing called imposter syndrome I will probably blog about later. There is the feeling that you are hitting a ceiling, that you need
to do more, be more, etc.. There is stress, crazy hours… It can be exhausting. I had a family that I wasn’t giving enough attention at times.
I was getting fatter and it was hard to find balance. That’s something you shouldn’t forget. It’s fine to break free and prosper, but <strong>don’t forget to focus on balance</strong>.
Balance is all. I started working out more, taking more time off and I started to focus more on the quality of life.</p>

<p>While we had 4 awesome years with StrongBrew, COVID-19 happened and Kwinten went to work for StackBlitz. That in combination with my focus
 change meant the death of StrongBrew. I’m not sorry StrongBrew ceased to exist, it was time for a new chapter.
I settled working for one client and I started a small company on the side where I gave culinary workshops on ceramic grills.
That turned out to be quite successful and I was able to focus on that as an (read the quotes) “entrepreneur” on the side.</p>

<p>My marriage fell apart, and I had to settle with seeing the kids for only 50% of the time, and I started to struggle with life.
I still had a decent income, worked for an awesome client called <a href="https://rosa.be">Rosa</a> which is shaping the future of healthcare.
In the beginning I worked 4/5th of my time for Rosa and 1/5th I was doing remote audits, code-reviews, technical interviews etc.
After 2 years of working for rosa I was so comfortable I worked full-time for them. 95% of my time I worked remotely in my office. I didn’t
do code-reviews anymore and I was basically a developer like everyone else in the company. Before I was always the coach, the architect,
the tech lead, whatever… I didn’t mind the title, but I could have been replaced by any senior developer. I didn’t provide the value I wanted to.
I was stuck in my comfort zone… I didn’t had to worry about finding business anymore and I was programming comfortably in my chair, drinking quality coffee
in my warm and cozy office.</p>

<p>I basically had everything. I was fit, I was able to keep the house after the divorce, my children were healthy, I met a beautiful girlfriend with a great personality.
Everything was going well in my life and still I had hard time to find happiness. Like a cancer it sneaks up on you. After a while you wake up and
you realise you are unfulfilled, unmotivated and you are basically agreeing with life, or at least settling with life.</p>

<h3 id="breaking-back-out">Breaking back out</h3>

<p>At a bonfire a friend of me saw the lack of joy in me and asked me to look up <a href="https://twitter.com/TonyRobbins">Tony Robbins</a> who was some kind of life
coach helping people to become better versions of themselves. I didn’t believe in life coaches, and I was sceptical at first but at a bored Netflix evening
I looked him up, and I haven’t stopped looking/reading since then. He made me realise some things:</p>
<ul>
  <li>Making money is science, it’s not the most important thing. <strong>Being happy… That’s art!</strong></li>
  <li>Helping/coaching/mentoring people and companies is what makes me happy. I wanted to have an impact, bring value…</li>
  <li>I needed to break out of my comfort zone once more to achieve it</li>
</ul>

<p>I decided to break free again, but this time I would find a better balance. No more business flights, no more crazy hours but I wanted to chase discomfort.
I decided to leave Rosa. A decision I made with a lot of pain in my heart because they became a family and it has been the most awesome company
I had ever worked for, but staying with Rosa was not an option.
I related Rosa with comfort, getting stuck, and it felt like a golden cage to me in that moment in my life.</p>

<p>I decided to make a change in my life three months ago and by getting out of my comfort zone at a daily basis things changed drastically.
I signed a contract as frontend software architect at DHL aviation, where I have to go to the office a few times a week.
It’s a big commute and it’s a huge company so it won’t be that comfortable but I can bring value there. I can help them set up a clean architecture, I can coach
people to become better developers and actually make a difference.</p>

<p>I also started blogging again where I hope I can bring value by sharing experience. Not just technical experience but also experience in life and career.</p>

<p>The last thing that I decided to do, was creating another workshop. Not just any workshop, but basically my 6-7 years of Angular experience
thrown into a one-day rollercoaster of Best Practices. I worked with so many companies, so many people. I have been in over 50 (maybe even 100) projects.
I have so much to share and I believe this is something I can bring value with.  It would be my only workshop. And I will contribute to it every month, keeping it up to date.
I don’t know what my path will bring me but that’s my focus for now.</p>

<p>I had broken out of my comfort zone once again and already things are getting brighter. 
I’ve already sold my <a href="https://brecht.io/angular-best-practices-workshop">Angular Best Practices Workshop</a> to 2 companies and there are some exciting things happening.
For some reason I’m able to ignore negative events in my life and focus on positive things. I found my zest for life back
and even though my life isn’t a pony camp, I’m happy and I have never been so motivated.</p>

<h3 id="conclusion">Conclusion</h3>

<p>I’ve written this article with one reason and one reason only. Earning money, having crazy titles in big companies isn’t what matters.
Making sure you are happy is way more important and if you are happy in your comfort zone, you could just stay there. 
But if you are not happy anymore and you feel there is no way forward, in your career or life in general… Sometimes making the uncomfortable
decisions will bring you the best chances.</p>

<p>I need something to look forward to and I want to live my life fully. I want to bring value and have the feeling
I made a difference. I know that getting out of my comfort zone will bring me chances and for me it’s better to take the occasional bad
decision, instead of not taking any decisions at all.</p>

<h3 id="thanks-for-the-reviewers">Thanks for the reviewers</h3>
<ul>
  <li><a href="https://twitter.com/aaron_delange">Aaron Delange</a></li>
  <li><a href="https://twitter.com/alvaro_ahc">Álvaro Herrero</a></li>
  <li><a href="https://twitter.com/webdave_de">Webdave</a></li>
  <li><a href="https://twitter.com/rsinis">Raul Sinisterra</a></li>
</ul>]]></content><author><name>brechtbilliet</name></author><summary type="html"><![CDATA[The people that are used to read my articles will quickly realise that this is not the type of articles I generally write. Since I’m passionate about this subject, I’m going to write about it anyway. Bear with me, you might take away something from it. If not, at least you gave it a shot, right? I’m writing a book as we speak about my life and career as a software professional, not sure if I’ll ever publish it, but consider this a very slimmed down version of some chapters of that book.]]></summary></entry><entry><title type="html">Conditional api urls in Angular with injection tokens</title><link href="http://localhost:4000/conditional-api-urls-in-angular-with-injection-tokens/" rel="alternate" type="text/html" title="Conditional api urls in Angular with injection tokens" /><published>2022-09-08T00:00:00+02:00</published><updated>2022-09-08T00:00:00+02:00</updated><id>http://localhost:4000/conditional-api-urls-in-angular-with-injection-tokens</id><content type="html" xml:base="http://localhost:4000/conditional-api-urls-in-angular-with-injection-tokens/"><![CDATA[<h2 id="using-envjs-files">Using env.js files</h2>
<p>When we deploy our Angular application, chances are big that we will let our data-access layer connect to another api url than the one
we connect to in development. This means that this api url should be configurable at some point.
There are multiple ways of working with environment variables in Angular code-bases.
I like to choose for a simple <code class="language-plaintext highlighter-rouge">env.js</code> file that can easily be replaced by the continuous integration (<a href="https://www.jvandemo.com/how-to-use-environment-variables-to-configure-your-angular-application-without-a-rebuild/">read this article</a>).
This way the <code class="language-plaintext highlighter-rouge">env.js</code> file is never really part of the build and can be replaced at all times.
This file could look like this:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app-name/src/env.js</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__env</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__env</span><span class="p">.</span><span class="nx">apiUrl</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://localhost:1234/api</span><span class="dl">'</span><span class="p">;</span>
<span class="p">})(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div></div>

<p>As we can see above we use an immediately invoked function expression (iife) where we just set these environment variables
directly on the window object. This approach would not work for server-side rendered applications but that’s beyond the goal of this article.</p>

<h3 id="how-do-we-achieve-a-working-solution">How do we achieve a working solution?</h3>

<p>What we need to do in the <code class="language-plaintext highlighter-rouge">angular.json</code> file is to add this <code class="language-plaintext highlighter-rouge">env.js</code> file to the <code class="language-plaintext highlighter-rouge">options.assets</code> array of the <code class="language-plaintext highlighter-rouge">build</code> target, so it will be available after
compilation time. We also need to import it into the <code class="language-plaintext highlighter-rouge">index.html</code> of our application.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;head&gt;</span>
    <span class="c">&lt;!-- Load environment variables --&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"env.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  ...
</code></pre></div></div>

<p>What we did so far is we made sure the variable <code class="language-plaintext highlighter-rouge">apiUrl</code> will be available in the <code class="language-plaintext highlighter-rouge">__env</code> property of the <code class="language-plaintext highlighter-rouge">window</code> object which is available everywhere in the frontend.
Calling the window directly in Angular is seen as a <strong>bad practice</strong> and calling <code class="language-plaintext highlighter-rouge">window['__env'].apiUrl</code> everywhere is even worse.</p>

<p>To consume the <code class="language-plaintext highlighter-rouge">apiUrl</code> in our Angular application in a proper way, we need to create an <code class="language-plaintext highlighter-rouge">InjectionToken</code> that we can use for dependency injection.
Let’s go ahead and create an <code class="language-plaintext highlighter-rouge">injection-tokens.ts</code> file that exposes the <code class="language-plaintext highlighter-rouge">API_URL</code> token.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app-name/src/injection-tokens.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">InjectionToken</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@angular/core</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">API_URL</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>We have our environment variables living on our <code class="language-plaintext highlighter-rouge">window</code> object and we have an injection token that we will use to inject that in any constructor.
The last thing that we need to do tell Angular that injecting the <code class="language-plaintext highlighter-rouge">API_URL</code> token into a constructor should retrieve the <code class="language-plaintext highlighter-rouge">apiUrl</code> living on the <code class="language-plaintext highlighter-rouge">__env</code> property of the
<code class="language-plaintext highlighter-rouge">window</code> object. To do that we have to add some logic to the <code class="language-plaintext highlighter-rouge">providers</code> property of the <code class="language-plaintext highlighter-rouge">@NgModule()</code> decorator of our <code class="language-plaintext highlighter-rouge">AppModule</code>.
We provide the <code class="language-plaintext highlighter-rouge">API_URL</code> in dthe provide property, we use a factory where <code class="language-plaintext highlighter-rouge">Document</code> is injected and we use <code class="language-plaintext highlighter-rouge">document.defaultView</code> which refers to the <code class="language-plaintext highlighter-rouge">window</code> object
to retrieve the <code class="language-plaintext highlighter-rouge">apiUrl</code> living in the <code class="language-plaintext highlighter-rouge">__env</code> property. Since we inject <code class="language-plaintext highlighter-rouge">Document</code> we need to add <code class="language-plaintext highlighter-rouge">DOCUMENT</code> to the deps property for it to become available.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="p">...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">provide</span><span class="p">:</span> <span class="nx">API_URL</span><span class="p">,</span>
      <span class="na">useFactory</span><span class="p">:</span> <span class="p">(</span><span class="na">document</span><span class="p">:</span> <span class="nx">Document</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">[</span><span class="dl">'</span><span class="s1">__env</span><span class="dl">'</span><span class="p">].</span><span class="nx">apiUrl</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="na">deps</span><span class="p">:</span> <span class="p">[</span><span class="nx">DOCUMENT</span><span class="p">],</span>
    <span class="p">},</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</code></pre></div></div>

<p>This is great! Now in our services we can just inject the <code class="language-plaintext highlighter-rouge">API_URL</code> with the <code class="language-plaintext highlighter-rouge">@Inject()</code> decorator, and our service knows exactly where to send its XHR calls to.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">Inject</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CONDITIONAL_API_URL</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./injection-tokens</span><span class="dl">'</span><span class="p">;</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span><span class="na">providedIn</span><span class="p">:</span><span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FooService</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">API_URL</span><span class="p">)</span> <span class="k">private</span> <span class="k">readonly</span> <span class="nx">apiUrl</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="extra-problem">Extra problem</h2>

<p>The essence of this article is not to explain environment variables nor InjectionTokens. Let’s dive a bit deeper than that.</p>

<p>A short while ago a client of mine had this specific use-case:
They had an entire application that was already running in production.
When their product grew they realised that there was a use-case where they wanted that exact application (the exact same logic) but they needed it to connect to another <code class="language-plaintext highlighter-rouge">apiUrl</code>.</p>

<p>The first thing that would come to mind, is to change the value of <code class="language-plaintext highlighter-rouge">apiUrl</code> in our <code class="language-plaintext highlighter-rouge">env.js</code> but the thing was they also needed the previous
flow to keep on working. They actually needed two flows of the same application that both had their own endpoint. Flow one needed to consume the old <code class="language-plaintext highlighter-rouge">apiUrl</code> and flow two needed to consume
the other <code class="language-plaintext highlighter-rouge">apiUrl</code>.</p>

<h3 id="lets-try-to-implement-this">Let’s try to implement this:</h3>

<p>Since we don’t want to touch the current routing flow we will pass a QueryParam called <code class="language-plaintext highlighter-rouge">secondary=true</code> to the url of our application. If that QueryParam exists we don’t want to consume
<code class="language-plaintext highlighter-rouge">window['__env'].apiUrl</code> but <code class="language-plaintext highlighter-rouge">window['__env'].secondaryApiUrl</code> and if it doesn’t exist we want to use <code class="language-plaintext highlighter-rouge">window['__env'].apiUrl</code>.</p>

<p>Let’s add the <code class="language-plaintext highlighter-rouge">secondaryApiUrl</code> to the <code class="language-plaintext highlighter-rouge">env.js</code> file and update the <code class="language-plaintext highlighter-rouge">injection-tokens.ts</code> and <code class="language-plaintext highlighter-rouge">app.module.ts</code> accordingly.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app-name/src/env.js</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__env</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__env</span><span class="p">.</span><span class="nx">apiUrl</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://localhost:1234/api</span><span class="dl">'</span><span class="p">;</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__env</span><span class="p">.</span><span class="nx">secondaryApiUrl</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://localhost:4321/api</span><span class="dl">'</span><span class="p">;</span>
<span class="p">})(</span><span class="k">this</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app-name/src/injection-tokens.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">InjectionToken</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@angular/core</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">API_URL</span><span class="dl">'</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">SECONDARY_API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">SECONDARY_API_URL</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app-name/src/app.module.ts</span>
<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="p">...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">provide</span><span class="p">:</span> <span class="nx">API_URL</span><span class="p">,</span>
      <span class="na">useFactory</span><span class="p">:</span> <span class="p">(</span><span class="na">document</span><span class="p">:</span> <span class="nx">Document</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">[</span><span class="dl">'</span><span class="s1">__env</span><span class="dl">'</span><span class="p">].</span><span class="nx">apiUrl</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="na">deps</span><span class="p">:</span> <span class="p">[</span><span class="nx">DOCUMENT</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">provide</span><span class="p">:</span> <span class="nx">SECONDARY_API_URL</span><span class="p">,</span>
      <span class="na">useFactory</span><span class="p">:</span> <span class="p">(</span><span class="na">document</span><span class="p">:</span> <span class="nx">Document</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">[</span><span class="dl">'</span><span class="s1">__env</span><span class="dl">'</span><span class="p">].</span><span class="nx">secondaryApiUrl</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="na">deps</span><span class="p">:</span> <span class="p">[</span><span class="nx">DOCUMENT</span><span class="p">],</span>
    <span class="p">},</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</code></pre></div></div>

<h3 id="how-will-we-decide-which-apiurl-to-take">How will we decide which apiUrl to take?</h3>

<p>In our <code class="language-plaintext highlighter-rouge">FooService</code> we could inject both the <code class="language-plaintext highlighter-rouge">API_URL</code> and the <code class="language-plaintext highlighter-rouge">SECONDARY_API_URL</code> together with the <code class="language-plaintext highlighter-rouge">ActivatedRoute</code> but
that seems like a lot of redundant code to implement in every service.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span><span class="na">providedIn</span><span class="p">:</span><span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FooService</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">activatedRoute</span><span class="p">:</span> <span class="nx">ActivatedRoute</span><span class="p">,</span>
    <span class="p">@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">API_URL</span><span class="p">)</span> <span class="k">private</span> <span class="k">readonly</span> <span class="nx">apiUrl</span><span class="p">,</span>
    <span class="p">@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">SECONDARY_API_URL</span><span class="p">)</span> <span class="k">private</span> <span class="k">readonly</span> <span class="nx">secondaryApiUrl</span><span class="p">,</span>

    <span class="p">){</span>
      <span class="kd">const</span> <span class="nx">conditionalApiUrl</span> <span class="o">=</span> <span class="nx">activatedRoute</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">secondary</span>
      <span class="p">?</span> <span class="nx">secondaryApiUrl</span>
      <span class="p">:</span> <span class="nx">apiUrl</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The following code would be way nicer and that’s what we will implement in a minute:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">Inject</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CONDITIONAL_API_URL</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./injection-tokens</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span><span class="na">providedIn</span><span class="p">:</span><span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">FooService</span> <span class="p">{</span>

 <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">CONDITIONAL_API_URL</span><span class="p">)</span> <span class="k">private</span> <span class="k">readonly</span> <span class="nx">apiUrl</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// console.log(apiUrl);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For this to work we need to create a new InjectionToken called <code class="language-plaintext highlighter-rouge">CONDITIONAL_API_URL</code> that will determine
which api url to choose. <code class="language-plaintext highlighter-rouge">CONDITIONAL_API_URL</code> is just a token that will use the <code class="language-plaintext highlighter-rouge">inject</code> function of Angular to inject
our 3 dependencies and will decide which api url to use based on the existence of the <code class="language-plaintext highlighter-rouge">secondary</code> QueryParam.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">inject</span><span class="p">,</span> <span class="nx">InjectionToken</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ActivatedRoute</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/router</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">API_URL</span><span class="dl">'</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">SECONDARY_API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">SECONDARY_API_URL</span><span class="dl">'</span>
<span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">CONDITIONAL_API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="p">(</span><span class="dl">'</span><span class="s1">CONDITIONAL_API_URL</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">factory</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">activatedRoute</span> <span class="o">=</span> <span class="nx">inject</span><span class="p">(</span><span class="nx">ActivatedRoute</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">apiUrl</span> <span class="o">=</span> <span class="nx">inject</span><span class="p">(</span><span class="nx">API_URL</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">secondaryApiUrl</span> <span class="o">=</span> <span class="nx">inject</span><span class="p">(</span><span class="nx">SECONDARY_API_URL</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">activatedRoute</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">.</span><span class="nx">secondary</span>
      <span class="p">?</span> <span class="nx">secondaryApiUrl</span>
      <span class="p">:</span> <span class="nx">apiUrl</span><span class="p">;</span>
  <span class="p">},</span>
<span class="p">});</span>
</code></pre></div></div>

<p>There is no need to provide <code class="language-plaintext highlighter-rouge">CONDITIONAL_API_URL</code>, we can just inject it in the <code class="language-plaintext highlighter-rouge">FooService</code> as we just shown.
Every time the application is loaded with the <code class="language-plaintext highlighter-rouge">secondary</code> queryParam in the url it will use the <code class="language-plaintext highlighter-rouge">SECONDARY_API_URL</code>.
Otherwise it will use the <code class="language-plaintext highlighter-rouge">API_URL</code>;</p>

<h2 id="conclusion">Conclusion</h2>

<p>InjectionTokens are a powerful thing and combining them with the <code class="language-plaintext highlighter-rouge">inject()</code> function of Angular (service locator pattern)
we can combine tokens and put functionality in them. For more information on the <code class="language-plaintext highlighter-rouge">inject()</code> function of Angular, take a
look at <a href="https://kevinkreuzer.medium.com/angular-inject-33c6ce8cfd07">this article</a>.</p>

<p><a href="https://stackblitz.com/edit/angular-ivy-byqm8u">Here</a> is a stackblitz example where we can find the source code.
<strong>Note:</strong> external javascript files in those stackblitz projects are not possible at the time of writing this.
That’s why we have added the contents of the <code class="language-plaintext highlighter-rouge">env.js</code> file directly into the <code class="language-plaintext highlighter-rouge">index.html</code>.</p>

<h3 id="thanks-for-the-reviewers">Thanks for the reviewers</h3>

<ul>
  <li><a href="https://twitter.com/webdave_de">Webdave</a></li>
  <li><a href="https://twitter.com/jvandemo">Jurgen Van de Moere</a></li>
</ul>

<p>Thanks, <a href="https://twitter.com/wim_holvoet">Wim Holvoet</a> for the idea of using injection tokens.</p>]]></content><author><name>brechtbilliet</name></author><summary type="html"><![CDATA[Using env.js files When we deploy our Angular application, chances are big that we will let our data-access layer connect to another api url than the one we connect to in development. This means that this api url should be configurable at some point. There are multiple ways of working with environment variables in Angular code-bases. I like to choose for a simple env.js file that can easily be replaced by the continuous integration (read this article). This way the env.js file is never really part of the build and can be replaced at all times. This file could look like this:]]></summary></entry><entry><title type="html">Routed Angular dialogs</title><link href="http://localhost:4000/routed-angular-dialogs/" rel="alternate" type="text/html" title="Routed Angular dialogs" /><published>2022-08-31T00:00:00+02:00</published><updated>2022-08-31T00:00:00+02:00</updated><id>http://localhost:4000/routed-angular-dialogs</id><content type="html" xml:base="http://localhost:4000/routed-angular-dialogs/"><![CDATA[<p>This article should be a rather short one.
It’s about how we can create dialogs in Angular. Using dialogs in Angular can be tackled in complex ways but can be easy as well.
When I started out with Angular I created this <a href="https://blog.brecht.io/Modals-in-angular2/">article</a>. This is already 6 years ago
at the time of writing this, and I believe there are better solutions now. Come to think of it… There already were.</p>

<h2 id="the-dialog-itself">The dialog itself</h2>

<p>A dialog could be nothing more than a <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code> with a <code class="language-plaintext highlighter-rouge">position:fixed</code> that contains a title and a body. We can use content-projection to pass a title and a body.
<code class="language-plaintext highlighter-rouge">@Input()</code> properties might not be enough here.
We could also use the <code class="language-plaintext highlighter-rouge">&lt;dialog&gt;</code> html element but for simplicity I chose not to use that for this article.
The simplest implementation can be found here:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-dialog</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
  &lt;h1 class="header"&gt;
    &lt;ng-content select="[my-dialog-header]"&gt;&lt;/ng-content&gt;
  &lt;/h1&gt;
  &lt;div class="body"&gt;
    &lt;ng-content select="[my-dialog-body]"&gt;&lt;/ng-content&gt;
  &lt;/div&gt;

  `</span><span class="p">,</span>
  <span class="na">styles</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">`
    :host {
      width: 400px;
      height: 400px;
      background: #ccc;
      display: flex;
      flex-direction: column;
      opacity: 0.9;
      position: fixed;
      left: 50%;
      padding: 8px;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    `</span><span class="p">,</span>
  <span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">MyDialogComponent</span> <span class="p">{}</span>
</code></pre></div></div>

<p>We use the <code class="language-plaintext highlighter-rouge">my-dialog-header</code> selector to project the header into the component and we use the <code class="language-plaintext highlighter-rouge">my-dialog-body</code> selector to project the body.</p>

<p>How we consume it, can be found here. I won’t add too much information since this should be self-explanatory:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
  &lt;my-dialog&gt;
    &lt;ng-container my-dialog-header&gt;Hi there!&lt;/ng-container&gt;
    &lt;ng-container my-dialog-body&gt;What's up?!&lt;/ng-container&gt;
  &lt;/my-dialog&gt;
  &lt;p&gt;
    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce gravida
   ...
  &lt;/p&gt;

  `</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppComponent</span> <span class="p">{}</span>

</code></pre></div></div>

<p>That was quite easy, we have a dialog that is always shown. In most cases that is not what we want of course. We want to show dialogs conditionally when 
the user performs actions. There are a few ways of managing the existence and visibility of our dialogs.</p>

<p>I’m not a huge fan of using libraries to do that for us (Except Angular Material CDK) because well, approach 3 is way easier.</p>

<h2 id="approach-one-the-dialog-service">Approach one: the dialog service</h2>

<p>In this approach we would create a service that handles the creation and destruction of these dialogs for us.
We could use the approach of my previous article I just mentioned, but it would be better to use the <code class="language-plaintext highlighter-rouge">Angular Material CDK</code> for that.
I’m not going into detail for this approach since it’s out of scope for this article, but the developer would be in charge of the lifecycle of
that component. The developer should always manually create the dialog and always manually destroy that dialog.</p>

<p>For confirmation-dialogs one could recommend this approach but for more complex dialogs it might be better to have something that
takes care of the lifecycle of our dialogs automatically.</p>

<p>Advantages:</p>
<ul>
  <li>We can easily inject a service that creates and destroys dialogs for us. However the only use-case I see is the one for confirmation dialogs.
They could always have the same api (no inputs and always a <em>confirm</em> and <em>cancel</em> button).</li>
</ul>

<p>Disadvantages:</p>
<ul>
  <li>We have to take care of dependency injection ourself.</li>
  <li>It’s not that easy to provide inputs and outputs.</li>
  <li>It’s rather complex in general.</li>
  <li>There is a lot of bookkeeping that we need to do just to show simple dialogs.</li>
</ul>

<p>Use case:</p>
<ul>
  <li>Confirmation dialogs.</li>
</ul>

<h2 id="approach-two-the-ngif-statement">Approach two: The *ngIf statement</h2>

<p>We can use <code class="language-plaintext highlighter-rouge">*ngIf</code> statements in our template that would determine whether dialogs are shown or not.
The syntax for this is quite easy:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-user-detail-dialog</span> <span class="na">*ngIf=</span><span class="s">"showUserDialog"</span><span class="nt">&gt;&lt;/my-user-detail-dialog&gt;</span>
</code></pre></div></div>

<p>When the <code class="language-plaintext highlighter-rouge">showUserDialog</code> property is <code class="language-plaintext highlighter-rouge">true</code> the component will be rendered and thus the dialog will be shown.
When it’s set back to false it will be hidden.</p>

<p>Advantages:</p>
<ul>
  <li>We don’t have to worry about the lifecycle of the component. When the dialog is destroyed we don’t need to worry about memory leaks.</li>
  <li>It’s a very simple and easy approach.</li>
</ul>

<p>Disadvantages:</p>
<ul>
  <li>It doesn’t scale. Imagine having tons of <code class="language-plaintext highlighter-rouge">*ngIf</code> statements in our code that are only there to determine when dialogs should be shown or not.</li>
  <li>What if a <code class="language-plaintext highlighter-rouge">&lt;user-row&gt;</code> component has a dropdown with 10 actions, all actions resulting in another dialog. That would result in 10
different <code class="language-plaintext highlighter-rouge">*ngIf</code> statements. This doesn’t scale.</li>
</ul>

<p>Use case:</p>
<ul>
  <li>When there is only one dialog we want to show, and we don’t want to have it configured to a route.</li>
</ul>

<h2 id="approach-3-routed-dialogs">Approach 3: Routed dialogs</h2>

<p>A best practice in web development is providing functionality that when a user refreshes the page he or she gets the exact same state as before.
They should not be redirected to the root page but they should stay in the exact same spot. At least that would result in the best user-experience.</p>

<p>Take this example for instance:
We have a page with a table of users. When we click on the user it would open something with detailed information of that user.
Whether that is shown in a dialog or a different page is irrelevant. <code class="language-plaintext highlighter-rouge">user/:userId</code> should result in the <code class="language-plaintext highlighter-rouge">&lt;user-detail&gt;</code> component.
In our minds this is a different page for now but, product management has just decided that <code class="language-plaintext highlighter-rouge">&lt;user-detail&gt;</code> is not a page but a dialog, which means we would have a <code class="language-plaintext highlighter-rouge">&lt;user-detail-dialog&gt;</code> component.</p>

<p>This approach is actually super easy. We create a <code class="language-plaintext highlighter-rouge">&lt;user-detail-dialog&gt;</code> that uses our previous <code class="language-plaintext highlighter-rouge">my-dialog</code> component.
We bind it to the <code class="language-plaintext highlighter-rouge">user/:userId</code> route with the help of a child <code class="language-plaintext highlighter-rouge">router-outlet</code> and everything works.</p>

<p>We don’t need a lot of code to achieve this:</p>

<p>Our app component just contains a <code class="language-plaintext highlighter-rouge">router-outlet</code>. This will be used to render the top level of routing config components.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app.component.ts</span>
<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
  &lt;router-outlet&gt;&lt;/router-outlet&gt;
  `</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppComponent</span> <span class="p">{}</span>
</code></pre></div></div>

<p>We have created a <code class="language-plaintext highlighter-rouge">&lt;users&gt;</code> component which loads some mocked user data and shows it in a table. This will be rendered in the
previously mentioned <code class="language-plaintext highlighter-rouge">router-outlet</code>. It also provides a detail link for every user that will navigate to <code class="language-plaintext highlighter-rouge">users/:userId</code>.
It’s very important to note here that below the table we have another child <code class="language-plaintext highlighter-rouge">router-outlet</code>. This will be used to render
the dialog in.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
  &lt;table&gt;
    &lt;tbody&gt;
      &lt;tr *ngFor="let user of users$|async"&gt;
        &lt;td&gt;&lt;/td&gt;
        &lt;td&gt;&lt;/td&gt;
        &lt;td&gt;
          &lt;a routerLink=""&gt;Detail&lt;/a&gt;
        &lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;
  &lt;router-outlet&gt;&lt;/router-outlet&gt;
  `</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersComponent</span> <span class="p">{</span>
  <span class="nx">users$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">usersService</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">();</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">usersService</span><span class="p">:</span> <span class="nx">UsersService</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We have created a <code class="language-plaintext highlighter-rouge">&lt;users-detail&gt;</code> component which uses our previous <code class="language-plaintext highlighter-rouge">&lt;my-dialog&gt;</code> component to display the details
of a user. Based on the <code class="language-plaintext highlighter-rouge">:userId</code> param it uses the <code class="language-plaintext highlighter-rouge">UsersService</code> to retrieve that information and show it with the necessary content projection.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users-detail</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
  &lt;my-dialog *ngIf="user$|async as user"&gt;
    &lt;ng-container my-dialog-header&gt;Details of  &lt;/ng-container&gt;
    &lt;ng-container my-dialog-body&gt;Role: &lt;/ng-container&gt;
  &lt;/my-dialog&gt;
  `</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersDetailComponent</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">userId$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activatedRoute</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">userId</span><span class="p">));</span>
  <span class="nx">user$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">userId$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">switchMap</span><span class="p">(</span><span class="nx">id</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">usersService</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span>
  <span class="p">)</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="nx">activatedRoute</span><span class="p">:</span> <span class="nx">ActivatedRoute</span><span class="p">,</span>
    <span class="k">private</span> <span class="nx">usersService</span><span class="p">:</span> <span class="nx">UsersService</span>
  <span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the module below we see the routingConfig. What is important here is that the <code class="language-plaintext highlighter-rouge">UsersDetailComponent</code> class
is configured within the children of the <code class="language-plaintext highlighter-rouge">UsersComponent</code> class. By looking closely at this config we can see that
we are dealing with 2 nested <code class="language-plaintext highlighter-rouge">router-outlet</code>’s.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">...</span>
    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">([</span>
      <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">redirectTo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">pathMatch</span><span class="p">:</span> <span class="dl">'</span><span class="s1">full</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">component</span><span class="p">:</span> <span class="nx">UsersComponent</span><span class="p">,</span>
        <span class="na">children</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:userId</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">component</span><span class="p">:</span> <span class="nx">UsersDetailComponent</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">],</span>
      <span class="p">},</span>
    <span class="p">]),</span>
  <span class="p">],</span>
  <span class="p">...</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</code></pre></div></div>

<p>That’s it. When product management decides that the details of a user should not be shown in a dialog but on a page
we should have minimal work to make that happen. We can refresh the page when we want and we don’t have to worry
about the lifecycle of our dialogs.</p>

<p>Advantages:</p>
<ul>
  <li>We can bookmark our dialog.</li>
  <li>We can share our url with colleagues.</li>
  <li>We can use the previous and back buttons of the browser.</li>
  <li>We can leverage <code class="language-plaintext highlighter-rouge">Guards</code> to block the user of navigating away from the dialog (maybe they have a dirty form in there).</li>
  <li>We don’t have to worry about memory leaks. We shouldn’t even know that the user detail information is shown in a dialog.</li>
</ul>

<p>Disadvantages:</p>
<ul>
  <li>Not ideal for confirmation dialogs (we don’t want to have confirm routes everywhere).</li>
</ul>

<p>Use case:</p>
<ul>
  <li>I would use this for all dialogs that are not generic.</li>
</ul>

<h2 id="angular-cdk">Angular CDK</h2>

<p>We could use the Angular CDK to clean up everything with position strategies etc but that can be material for a next article.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Adding state in routes gives us a bunch of advantages. Using that state can be used to show or hide a dialog.
Whether a view is shown in a dialog or another page shouldn’t determine the routing configuration.</p>

<p>You can check the demo <a href="https://stackblitz.com/edit/angular-ivy-3qe9tv?file=src%2Fapp%2Fmy-dialog%2Fmy-dialog.component.ts,src%2Fapp%2Fapp.component.ts,src%2Fapp%2Fapp.module.ts,src%2Fapp%2Fmy-dialog%2Fmy-dialog.component.css,src%2Findex.html,src%2Fapp%2Fusers.service.ts,src%2Fapp%2Fusers-detail%2Fusers-detail.component.ts,src%2Fapp%2Fusers%2Fusers.component.ts">here</a></p>
<iframe width="100%" height="500px" src="https://stackblitz.com/edit/angular-ivy-3qe9tv?embed=1&amp;file=src/app/users-detail/users-detail.component.ts"></iframe>

<h2 id="reviewers">Reviewers</h2>

<p>Special thanks for the awesome reviewers:</p>
<ul>
  <li><a href="https://twitter.com/tim_deschryver">Tim Deschryver</a></li>
  <li><a href="https://twitter.com/rubverm">Ruben Vermeulen</a></li>
  <li><a href="https://twitter.com/webdave_de">Webdave</a></li>
</ul>]]></content><author><name>brechtbilliet</name></author><summary type="html"><![CDATA[This article should be a rather short one. It’s about how we can create dialogs in Angular. Using dialogs in Angular can be tackled in complex ways but can be easy as well. When I started out with Angular I created this article. This is already 6 years ago at the time of writing this, and I believe there are better solutions now. Come to think of it… There already were.]]></summary></entry><entry><title type="html">Angular interview questions for catching senior talent</title><link href="http://localhost:4000/angular-interview-questions-for-seniors/" rel="alternate" type="text/html" title="Angular interview questions for catching senior talent" /><published>2022-08-12T00:00:00+02:00</published><updated>2022-08-12T00:00:00+02:00</updated><id>http://localhost:4000/angular-interview-questions-for-seniors</id><content type="html" xml:base="http://localhost:4000/angular-interview-questions-for-seniors/"><![CDATA[<p>Companies ask me to take care of technical interviews from time to time. Having done quite a lot of these interviews, 
I learned a lot from them. 
By helping out a lot of different clients, I also have been on the other side of the table more than a few times too.
This means I have learned some patterns on how to create a positive impression towards my interviewer, and I know how to estimate
the candidate as well.
I don’t like to ask for technical assessments because I value the time of the candidate, and I’d like to think of them as people, not programming machines.
That being said, I do understand technical assessments work for a certain people and companies, it just might be my gut and preference.
This blog article is the beginning of a set of many blog articles that will focus on interview questions.
Every article will contain 20 questions that we can ask as an interviewer + the kind of answer I would be looking for.
Bear in mind, there is no right answer, but I like to bring you in my chain of thought of how I reason in these kind of interviews.
This one is specific to Angular, another might be focussed on architecture, and another one maybe on javascript/typescript or testing and I’m pretty sure
RxJS will also get his own article.
Bear in mind that most of these questions can be hard for junior profiles. But then again, not all questions
have to be answered thoroughly.</p>

<p>I’m not a huge fan of asking a candidate questions like:</p>
<blockquote>Tell me all the different lifecycle hooks that Angular components offer us, and tell me 
in which order they are being executed.</blockquote>
<p>Questions like that could make our candidate uncomfortable and stressed out.
I also don’t like to ask:</p>
<blockquote>What's the difference between `markForCheck()` and `detectChanges()`?</blockquote>
<p>I’d love to hear it in a response of
another question I might ask but we shouldn’t focus on api specifics. Maybe sometimes I would ask for api specifics, but then it only means the candidate has answered
most of the other things and he or she is really doing a good job. And let’s be honest… Everyone can memorize api’s…</p>

<p>Why would we ask people if they could memorize all the api’s a framework has to offer? When we can try to understand how they think
and reason about problems and proper solutions? This is the reason we should focus on open questions that can be answered in many ways.
The more open our questions are as to the candidates, the more we learn from the piece of talent we are interviewing.
We only have limited time right?!</p>

<p>Our candidate can give us some nice twists like sidetracking on best-practices and bad-practices.
I love to hear long answers where the candidate can show his or her passion about Angular and the surrounding experience.</p>

<p>For every question I will try to explain on how I personally would answer the question and why, so basically what could make me happy as the hypothetical interviewer.
The concrete answers will not be found here, that is something you have to do on your own.</p>

<h3 id="1-name-all-the-ways-you-can-think-about-on-how-components-communicate-with-each-other-in-angular">1: Name all the ways you can think about on how components communicate with each other in Angular?</h3>

<p>This is a very simple question but can still be used to blow the mind of the interviewer. 
I would start that the easiest way for component communication would definitely be the use of <code class="language-plaintext highlighter-rouge">@Input()</code> and <code class="language-plaintext highlighter-rouge">@Output()</code> properties. 
I would mention that data flows from parent components towards child components through <code class="language-plaintext highlighter-rouge">@Input()</code> properties and we
pass that data into the component with the square brackets syntax <code class="language-plaintext highlighter-rouge">[foo]="bar"</code>. The child component can notify the parent components
through the famous <code class="language-plaintext highlighter-rouge">@Output()</code> properties and for that we use the square bracket syntax <code class="language-plaintext highlighter-rouge">(change)="onChange($event)"</code>.
Yes, yes this is also api specific, but let’s face it. If they don’t know that api they simply haven’t used Angular, and I have gotten
my share of candidates who were unable to answer that question.</p>

<p>I would maybe mention that for <code class="language-plaintext highlighter-rouge">@Output()</code> names we should never use <code class="language-plaintext highlighter-rouge">onChange</code> or <code class="language-plaintext highlighter-rouge">onClick</code> but we rather use <code class="language-plaintext highlighter-rouge">change</code> or <code class="language-plaintext highlighter-rouge">click</code>.
That is more consistent with the current api of Angular and it’s a known best practice.</p>

<p>I could talk about injecting parent components into child components through dependency injection in the constructor. 
I would focus even more on when I would do that and if it is a good idea in general.
I personally consider this to be a bad practice in a lot of cases as it breaks the unidirectional dataflow and makes it quite complex. 
That being said, I can give an example on where I inject a custom form component into an input-wrapper component to see if the form is submitted or not.</p>

<p>I can go on about ViewChildren where one could gain access to child components within parent components.
This also creates a form of communication. Maybe I step it up a notch and explain the difference between ViewChildren and ContentChildren.</p>

<p>Lastly I would talk about how to use services to communicate between different components and that in general I wouldn’t do that to communicate between
children and parents. I’d say that it might be a good idea to let siblings communicate with each other. Although in many cases we can use the parent component for that. 
When we want to communicate between a parent and a child, but there is a router-outlet in between it might be a good fit to use a service for that.</p>

<h4 id="bonus-question-can-you-name-a-bad-way-to-let-components-communicate-with-each-other-and-why">Bonus question: Can you name a bad way to let components communicate with each other and why?</h4>

<p>I would probably say we could use the window object to do that, but that it is not a good idea because we lose all the encapsulation and we should not communicate 
with the window object directly. It would create complexities, dependencies we don’t want and we are communicating outside of the framework.</p>

<p>We could also use redux or @ngrx/store to communicate between components. I would also consider this to be a bad practice since we are using a complex
framework for something very simple and we are creating a very hard dependency in every layer of our code. That being said, this is a personal opinion
and I’d love to hear the perspective of the candidate.</p>

<h3 id="2-how-would-you-structure-components-in-angular">2: How would you structure components in Angular?</h3>

<p>I would talk about smart and dumb components and what their responsibility is and how we keep them dumb components ignorant to the rest of the application but
that they still can have complex logic. I’d probably give an example that a month view of a calendar is stupid, but can be very complex.
I would say that splitting up into more and smaller components is beneficial for:</p>
<ul>
  <li>Control over change detection when using the <code class="language-plaintext highlighter-rouge">ChangeDetection.OnPush</code> strategy</li>
  <li>Testability</li>
  <li>Less observable subscriptions</li>
  <li>Single responsibility principle</li>
  <li>Separation of concerns</li>
  <li>Reusability</li>
</ul>

<p>I’d also keep a separate folder for smart and dumb components so they don’t get mixed up.</p>

<p>I could talk about when I would extract code from the component. I could talk about preference of inline templates 
or not and share the advantages and disadvantages for both ways. It’s important to show that that I am not biased and
that both solutions could work.</p>

<h4 id="bonus-question-tell-me-the-difference-between-pipes-and-components">Bonus question: Tell me the difference between pipes and components</h4>

<p>I don’t think this question should be answered here since it’s a very straightforward question.</p>

<h3 id="3-dependency-injection-services-lifecycle-of-services-and-use-cases-go">3: Dependency injection, services, lifecycle of services and use cases. go!</h3>

<p>With this question we can really show that we know exactly how Angular works in terms of dependency injection.
I could talk about services and how to make them injectable. I would say that we can provide services in modules and
that they would become singleton for the entire application. After that I’d say that we can also provide them in
lazy loaded modules (by using providedIn:’any’) which would result in singleton at that modules level. Then I could explain how we can also
provide them at any component and that the lifecycle would be shared with those components.
A nice addition there is to mention that if we provide them at component level we could also implement <code class="language-plaintext highlighter-rouge">ngOnDestroy()</code> lifecycle hooks
in the services. Some nice examples on services in components would be very welcome and I would probably say I could use it
to remove redundancy from 2 big fat smart components that share 80% of the same code.
It would be my moment to mention that I prefer composition over inheritance.</p>

<p>A nice addition would be explaining the <code class="language-plaintext highlighter-rouge">providedIn: 'root'</code> syntax in the <code class="language-plaintext highlighter-rouge">Injectable()</code> decorator and that this creates an
application wide singleton instance. It would also be worth mentioning that this improvement was there to make treeshaking possible.</p>

<p>This is a great moment to start about the standalone components that Angular 14 brings with it, and I could give my opinion
on Angular modules in general. By mentioning that Angular modules were introduced in angular2@rc5 I could prove my experience.</p>

<p>The reason why I am saying this is not to brag, it’s to show how deep you could go with this question.</p>

<h3 id="4-whats-the-difference-between-guards-and-interceptors">4: What’s the difference between guards and interceptors?</h3>

<p>I like this question because we ask 2 things at the same time. Guards and interceptors don’t have anything to do with each other
but they are important tools within the framework. After explaining what guards are I could come up with examples on either
when to use the <code class="language-plaintext highlighter-rouge">canActivate</code> guard but also explain the less often used <code class="language-plaintext highlighter-rouge">canDeactivate</code> guard. A nice example there would be when
the user has filled in a form and we don’t want to block him from navigating away.</p>

<p>I would explain that I don’t only use interceptors for adding jwt tokens but I could also use them for loading state, error handling and so much more.</p>

<h3 id="5-what-is-the-async-pipe">5: What is the <code class="language-plaintext highlighter-rouge">async</code> pipe?</h3>

<p>Not only could I say we could use the <code class="language-plaintext highlighter-rouge">async</code> to subscribe on observables, I could start talking about RxJS and that it is the only real dependency Angular has besides zone.js.
I would say that the async pipe, subscribes to the observable, also unsubscribes from the observable when the component gets destroyed and I would talk about
how it runs a <code class="language-plaintext highlighter-rouge">markForCheck()</code> as well.</p>

<p>I would say I consider using the <code class="language-plaintext highlighter-rouge">async</code> pipe as a best practice because it does a lot of management for us (subscribing, unsubscribing, mark for check).
Maybe I would even talk about the <code class="language-plaintext highlighter-rouge">*ngIf=foo$|async as foo</code> syntax where we can keep the value of the observable inside the template
and share it like that. I could mention that it can be dangerous if foo has a falsy value.</p>

<h3 id="6-tell-me-about-rxjs-in-angular-what-reactive-apis-are-there">6: Tell me about RxJS in Angular, what reactive api’s are there?</h3>

<p>This is a beauty because you can talk about so much here.
It might be a good idea to start talking about my passion in RxJS first and how I fell in love with it.
After that could talk about how the router is reactive and that we can subscribe to events.
The activated route gives us observable params, queryParams and so much more.
We could talk about Reactive forms and how the <code class="language-plaintext highlighter-rouge">valueChanges</code> property is observable.
ViewChildren and ContentChildren can also be observable.</p>

<p>I would also like to talk about the <code class="language-plaintext highlighter-rouge">HttpClient</code> returning observables instead of promises and that unsubscribing from
an observable that is performing an XHR call will result in an <code class="language-plaintext highlighter-rouge">xhr.abort()</code>  behind the scenes.</p>

<p>If I want to blow the interviewer his mind I’d mention that <code class="language-plaintext highlighter-rouge">@Output()</code> EventEmitters are also observables behind the scenes and that
you can replace the EventEmitters with any kind of observable</p>

<h3 id="7-give-me-an-easy-way-to-create-a-memory-leak-in-angular-and-how-to-fix-it-eg-setinterval">7: Give me an easy way to create a memory leak in Angular and how to fix it. Eg setInterval()</h3>

<p>If the candidate does not understand the question: You have to add a <code class="language-plaintext highlighter-rouge">setInterval(console.log)</code> statement somewhere in a piece of code 
that will be destroyed and we want to keep seeing numbers logged in the console.</p>

<p>This should help the candidate enough. What will get destroyed and reinstantiated? Components will.
So adding that piece of code in the constructor or <code class="language-plaintext highlighter-rouge">ngOnInit()</code> of a page that is a component and navigating away from that 
could do the trick. By clearing the interval on <code class="language-plaintext highlighter-rouge">ngOnDestroy()</code> we could clean up that memory leak.</p>

<p>I would start on how easy it is to create memory leaks with RxJS and that it’s important to always clean up subscriptions.
This might be a tough question but we could really peek into the reasoning of the attendee here.</p>

<h3 id="8-how-would-you-test-angular-applications">8: How would you test Angular applications?</h3>

<p>This question has a lot of different answers, and none of them are right or wrong. But it’s a great way to see how the
candidate feels about testing, where the priorities lie and how much experience they have with testing Angular applications.</p>

<p>I would first talk about the testing pyramid vs snowcone and how today I prefer something like the honeycomb principle:
A small amount of unit tests (only the real complex logic), a lot of integration tests for the components, a small amount of E2E tests 
to test the happy flows.
I would say something like I unittest the real logic in services and I don’t use TestBed but <code class="language-plaintext highlighter-rouge">jest</code> just like I would test
any javascript or typescript class or function. I’d back it up with complexity, performance and why I don’t like to be bound to a specific framework.
For components I use a combination of <code class="language-plaintext highlighter-rouge">cypress</code> and <code class="language-plaintext highlighter-rouge">storybook</code> as integration tests were we would create a storybook of the usecase
we would test and use <code class="language-plaintext highlighter-rouge">cypress</code> to do so.
I would also use <code class="language-plaintext highlighter-rouge">cypress</code> to tackle the E2E tests, but since these are slow and hard to maintain I wouldn’t write too much of them.</p>

<p>I would challenge the use of a huge amount of unit tests because they are very brittle (an extra dependency in the constructor breaks every test).
and if we break a <code class="language-plaintext highlighter-rouge">cypress</code> <code class="language-plaintext highlighter-rouge">storybook</code> integration test chances are quite big that we actually broke something.</p>

<h3 id="9-explain-to-me-how-change-detection-works-in-angular">9: Explain to me how change detection works in Angular</h3>

<p>Here I could talk about <code class="language-plaintext highlighter-rouge">zone.js</code> monkey patches all the native browser events and that Angular uses it to get notified when something happens.
I could talk about how Angular takes the component hierarchy and by default evaluates all the components from top to bottom.
I could say that this isn’t the most performant thing to do and could explain how the <code class="language-plaintext highlighter-rouge">ChangeDetection.OnPush</code> strategy helps us with that.
When talking about that strategy we could explain the <code class="language-plaintext highlighter-rouge">markForCheck</code> thingy and the difference between <code class="language-plaintext highlighter-rouge">ChangeDetectorRef.markForCheck()</code> 
and <code class="language-plaintext highlighter-rouge">ChangeDetectorRef.detectChanges()</code>. We could also explain that we need immutable data flows to make this work and that it does not make sense
to use the <code class="language-plaintext highlighter-rouge">ChangeDetection.Onpush</code> strategy on components that don’t have any inputs.</p>

<p>I would sidetrack on the advantages of immutable data structures and that its predictability is of more use than the performance gain.</p>

<p>It might also be worth noting that the <code class="language-plaintext highlighter-rouge">async</code> pipe also triggers a <code class="language-plaintext highlighter-rouge">markForCheck</code>, but we already said that didn’t we?.</p>

<h4 id="bonus-question-what-happens-if-you-apply-the-changedetectiononpush-strategy-on-your-app-component">Bonus question: What happens if you apply the <code class="language-plaintext highlighter-rouge">ChangeDetection.OnPush</code> strategy on your app component?</h4>

<p>I could explain here that it’s not a good idea to do that because it will basically break your change detection and you have to manually
run <code class="language-plaintext highlighter-rouge">markForCheck()</code>  for everything. A nice example could be this one:
When we do an <code class="language-plaintext highlighter-rouge">httpClient.get('url').subscribe(result =&gt; this.result = result)</code> in our code. Our application will never update because it isn’t marked for check.
Also the change detection deep within your component hierarchy could be broken. Another thing is that our app component doesn’t have any <code class="language-plaintext highlighter-rouge">@Input()</code> properties so it is useless anyway.</p>

<h3 id="10-what-is-the-expression-has-changed-after-it-was-checked-error">10: What is the Expression has changed after it was checked error?</h3>

<p>I would start to laugh about the fact that this bug has bitten me in the butt more than once and explain when and how much it has occurred.
I would say that the change detection ran twice in development and that both results are compared.
If the results that are used in the template don’t match it means something has changed in between proving that there is something wrong with our “clean” dataflow.</p>

<p>I could also explain why this isn’t run in production and that even the bug is harmless, it does shed some light on problems.</p>

<h3 id="11-how-can-you-tackle-redundancy-in-angular">11: How can you tackle redundancy in Angular?</h3>

<p>Very open question, if you are a senior profile you could talk for tens of minutes but I will wrap it up quite shortly here:</p>

<ul>
  <li>We can extract logic into reusable components</li>
  <li>We can extract logic into reusable directives</li>
  <li>We can extract logic into reusable pipes</li>
  <li>we can extract logic into reusable functions that we expose in javascript modules (better treeshaking)</li>
  <li>We can extract logic in services</li>
</ul>

<h3 id="12-what-is-trackby-and-how-does-it-work">12: What is trackBy and how does it work?</h3>

<p>This question proves a level of seniority of the candidate within the framework.
I would explain that every <code class="language-plaintext highlighter-rouge">*ngFor</code> statement could benefit from that and how the performance is optimised.
Especially with big lists this property can have a huge impact.</p>

<h3 id="13-tell-me-about-angular-cli">13: Tell me about Angular CLI.</h3>

<p>Here I can talk about code generation, about webpack. Maybe if I really want to make an impression I can talk about
why you think they chose for <code class="language-plaintext highlighter-rouge">webpack</code> and not <code class="language-plaintext highlighter-rouge">rollup</code>. Maybe mention why I think it wouldn’t work with <code class="language-plaintext highlighter-rouge">vite</code> now.
I could talk about schematics and that there is a thing called Nx that takes the Angular CLI to the next level. 
I could talk about updating to new versions. I could talk about ng-packagr and how I would create a public Angular package.
I would talk about the CLI sets up webpack configs, unit test configurations, prettier config, linting config files etc.</p>

<h3 id="14-how-do-you-consume-params-from-an-activatedroute-and-do-you-see-complexities-there">14: How do you consume params from an ActivatedRoute and do you see complexities there?</h3>

<p>Here I could say is that injecting the <code class="language-plaintext highlighter-rouge">ActivatedRoute</code> gives us observables of params but also snapshots if we want.
I could say that it only has access to its own params, and not to the params of its parent router-outlets.
Unless we set the <code class="language-plaintext highlighter-rouge">paramsInheritanceStrategy</code> of the routerconfig to <code class="language-plaintext highlighter-rouge">always</code> that is.</p>

<p>I would share frustrations that it is complex to access params from child router outlets and that it should also be available
because they are available in the url, but that I believe they have developed it like that to support auxiliary routes.</p>

<p>I would use this question to talk about how I love nesting router-outlets and using them to display dialogs so that Angular
takes care of the lifecycle for me.</p>

<p>One last thing to mention here is that when a param changes, the component is not being destroyed and reinstantiated.</p>

<h3 id="15-name-your-3-favourite-angular-characteristics">15: Name your 3 favourite Angular characteristics</h3>

<p>This question speaks for itself. You can verify experience, reasoning, passion and the ability to challenge technical decisions
by listening to the candidate talk.</p>

<p>My personal favorite is the integration with RxJS, the fact that it is opinionated and I think it is suited for huge projects.</p>

<h3 id="16-name-your-3-biggest-angular-frustrations">16: Name your 3 biggest Angular frustrations</h3>

<p>This question also speaks for itself. You can verify experience, reasoning, passion and the ability to challenge technical decisions
by listening to the candidate.</p>

<p>My biggest frustration is its bundle size, the build time and the ReactiveForms.
I would continue on the fact that it is nice that Angular 14 gives us typed forms but that I see a lot of improvements there.</p>

<h3 id="17-explain-how-you-would-do-content-projection-in-angular">17: Explain how you would do content projection in Angular</h3>

<p>I could start out by the fact that you can have an <code class="language-plaintext highlighter-rouge">&lt;ng-content&gt;</code> slot and whatever I put between the tags of my components would be rendered there.
I could also mention that you can have multiple slots that I could name. And that all these slots can be referenced in the component
by using <code class="language-plaintext highlighter-rouge">@ContentChildren()</code>. After that I would probably start giving examples on where to use multiple slots like dialogs that have
both a title and a body section.</p>

<p>After that I could also explain that there is a thingy called <code class="language-plaintext highlighter-rouge">ngTemplateOutlet</code> but to be quite honest, that kind of stuff is the
stuff I have to look up every time I need it. That being said, mentioning the existence of it is way more important then
knowing the api by heart.</p>

<p>I could even say it is possible to render content from the right view into the left view by using services to pass template references, 
but now I’m just trying to be smart even though it is possible.</p>

<h3 id="18-tell-me-something-about-selector-prefixes">18: Tell me something about selector prefixes.</h3>

<p>Again a question where you can validate the experience and reasoning.</p>
<ul>
  <li>I’d say every component selector has a prefix, but selectors aren’t even mandatory so prefixes aren’t either.</li>
  <li>We pass these prefixes so they are unique and it’s easier to see where they live.</li>
  <li>We use linting rules to validate if the prefixes are used correctly</li>
  <li>Both components and directives can have prefixes.</li>
  <li>It’s a bad practice not to have prefixes.</li>
  <li>Prefixes are both stored in the <code class="language-plaintext highlighter-rouge">project.json</code> (for Nx) and <code class="language-plaintext highlighter-rouge">angular.json</code> (for Angular CLI) file for schematic generation of components and directives, and they are also
defined in the linting config files</li>
</ul>

<p>This question is different then the other ones, here the candidate can just make a list of all the things he or she knows about a 
simple subject.</p>

<h3 id="19-what-version-upgrades-of-angular-were-really-exciting-for-you-and-why">19: What version upgrades of Angular were really exciting for you and why?</h3>

<p>This is a very easy question to check on seniority or if the candidate is up to date with the newest version.</p>

<p>At the time of writing I would talk about standalone components and typed forms in Angular 14.
That is was pretty weird that there was no Angular 3 but that I understand why.</p>

<p>I would go on that I was pretty frustrated that angular2@rc5 had modules when angular2@rc4 had not…
And that I had to rewrite my Angular fundamentals workshop just before my public workshops were planned.</p>

<p>I would go on that the upgrade path had gotten easier and that updating to Angular 6 was a pain in the butt for me.</p>

<p>I’d probably also be a bit more negative about Ivy because at ngVikings they showed a hello world of a few kilobytes
but that never seemed to become reality.</p>

<p>You see the question here shouldn’t be about remembering versions, it should trigger the candidate to talk about his or
hers experience with Angular and which updates were important.</p>

<h3 id="20-who-do-you-follow-which-blogs-do-you-read-what-do-you-do-to-keep-up-to-date-with-angular">20: Who do you follow? Which blogs do you read? What do you do to keep up to date with Angular?</h3>

<p>This is one of my favorites. One could talk about pluralsight or egghead trainings.
They could mention Angular core team members, or interesting pull requests.
They could talk about conferences or at least a talk they were interested in.
They can talk about books, interesting talks with colleagues and so on.
They can talk about pet projects and stuff they are doing in their own time.</p>

<p>This is a great question: not to test seniority, but to test passion and motivation in the framework.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Keep the questions limited, keep them short and expect long answers. You might be surprised how smart our candidate is.
Every body can learn a framework, but not all of us can learn to reason. And syntax is easily forgotten of it has been a few months or
even weeks until we have used it in practice. Hope you enjoyed the article!</p>

<p>Special thanks to the awesome reviewers:</p>
<ul>
  <li><a href="https://twitter.com/tim_deschryver">Tim Deschryver</a></li>
  <li><a href="https://twitter.com/SantoshYadavDev">Santosh Yadav</a></li>
  <li><a href="https://twitter.com/GregOnNet">Gregor Woiwode</a></li>
  <li><a href="https://twitter.com/tomeustace">Tom Eustace</a></li>
  <li><a href="https://twitter.com/webdave_de">Webdave</a></li>
</ul>]]></content><author><name>brechtbilliet</name></author><summary type="html"><![CDATA[Companies ask me to take care of technical interviews from time to time. Having done quite a lot of these interviews, I learned a lot from them. By helping out a lot of different clients, I also have been on the other side of the table more than a few times too. This means I have learned some patterns on how to create a positive impression towards my interviewer, and I know how to estimate the candidate as well. I don’t like to ask for technical assessments because I value the time of the candidate, and I’d like to think of them as people, not programming machines. That being said, I do understand technical assessments work for a certain people and companies, it just might be my gut and preference. This blog article is the beginning of a set of many blog articles that will focus on interview questions. Every article will contain 20 questions that we can ask as an interviewer + the kind of answer I would be looking for. Bear in mind, there is no right answer, but I like to bring you in my chain of thought of how I reason in these kind of interviews. This one is specific to Angular, another might be focussed on architecture, and another one maybe on javascript/typescript or testing and I’m pretty sure RxJS will also get his own article. Bear in mind that most of these questions can be hard for junior profiles. But then again, not all questions have to be answered thoroughly.]]></summary></entry><entry><title type="html">Why and how I created a SPA router for Qwik</title><link href="http://localhost:4000/why-and-how-i-created-a-spa-router-for-qwik/" rel="alternate" type="text/html" title="Why and how I created a SPA router for Qwik" /><published>2022-08-03T00:00:00+02:00</published><updated>2022-08-03T00:00:00+02:00</updated><id>http://localhost:4000/why-and-how-i-created-a-spa-router-for-qwik</id><content type="html" xml:base="http://localhost:4000/why-and-how-i-created-a-spa-router-for-qwik/"><![CDATA[<h2 id="the-why">The why</h2>

<p>The people from <a href="https://builder.io">builder.io</a> have done an awesome job writing <a href="https://qwik.builder.io/">Qwik</a>, and their arsenal of other great tools.
I started playing with Qwik some time ago and decided to rewrite my website <a href="https://brecht.io">brecht.io</a> in it. 
(I’m also planning to use Qwik in more complex apps, but I wanted to see my website in production first.)
When I started reworking my website, there wasn’t a tool that took care of in-page SPA (single page application) routing — or at least not how I’m used to it from other client-side technologies.
I’m used to working with SPA routing in <a href="https://angularjs.org/">AngularJS</a>, <a href="https://angular.io">Angular</a>, and <a href="https://reactjs.org/">React</a>, so I wanted to explore their routing principles in Qwik applications.</p>

<p>There is this thing, called Qwik-city, which is crazy fast and offers MPA (multiple page application) routing.
At the time of writing, Qwik had no full-fledged client-side router that offered SPA routing.
Great news for me, the nerd that I am, so I decided to dive deeper and write a custom SPA router for Qwik. It has been an interesting journey
that made me appreciate Qwik even better and helped me “think in” Qwik.</p>

<p>Now, before I continue, let’s align on the differences between MPA-routing and SPA-routing. 
In short: In MPA-routing, the page does a full page refresh on every navigation.
SPA-routing uses the <code class="language-plaintext highlighter-rouge">history</code> property of the <code class="language-plaintext highlighter-rouge">window</code> object to manage routing state. So for SPA-routing, the page does not refresh completely and the goal
is to only re-render parts of the page. When we look back at older technologies, SPA-routing used to be way faster, but with Qwik-city
the difference in performance might be trivial.</p>

<h3 id="now-why-am-i-writing-this">Now why am I writing this?</h3>

<p>Well, because… it’s a cool exercise… I learned a lot, I hit walls I didn’t expect to hit, and it helped me understand pain points I experienced with routers in other frameworks.
But that’s not enough, right? No, that is not my only driving factor for demystifying SPA-routing in Qwik.
I believe SPA routers do have quite a few benefits. I believe in Qwik, and I think it would be even more awesome to see it work with SPA-routing.</p>

<h4 id="state">State</h4>

<p>One of the advantages of a SPA-router is that we don’t lose application state… 
Since the instance of our application is only created once and kept alive, we can keep the state alive in our application.
We can not only share state between components, but also between pages. 
Some users like their sidebar collapsed, others don’t. It’s kind of annoying when you collapse a sidebar, then navigate to another page
where the sidebar jumps open again because state is not shared.</p>

<h4 id="the-power-of-routing-state">The power of routing state</h4>

<p>I’m a big fan of putting state (params and searchParams) in routes. Not all state belongs there, but keeping state in routes gives us some benefits:</p>

<ul>
  <li>We can bookmark a page without losing that state.</li>
  <li>We can copy/paste URLs to share them with other people without losing that state that is kept in that route.</li>
  <li>It’s free to manage, no need for complex frameworks, no complexity regarding state invalidation, etc. <!-- This may be true at first, but the Navigation History proposal summarizes some cases where it stops being true: https://github.com/WICG/navigation-api/blob/main/README.md#summary --></li>
  <li>We can use the browser navigation buttons to go back to previous and next states.</li>
</ul>

<p>Do note: When using MPA-routing we can also put the state in the url, but the more state that would change in the url, the more page refreshes we would have
which would result in less usability.</p>

<h4 id="usability">Usability</h4>

<p>Having pages refresh on every route change can cause certain discomforts to the usability of our application.</p>

<ul>
  <li>Cursor position being forgotten on refresh.</li>
  <li>Selected text getting unselected on refresh.</li>
  <li>A video call that is being held or even a movie we are watching would be closed on refresh</li>
  <li>Background sound being interrupted on refresh.</li>
  <li>Open dialogs, snackbars, banners and success messages are hard to show/keep alive on full refresh. 
Eg: Sending the contents of a form in page A, and navigating to page B on success. How and when would you show a success message? 
MPA frameworks often call this “flash” messaging, but it’s easier to manage in a SPA.</li>
</ul>

<h4 id="performance">Performance</h4>

<ul>
  <li>We only want to load stuff we need, that’s the entire idea behind Qwik. Does it makes sense to reload the same DOM when we already have it?</li>
  <li>Does it make sense to re-render part of the DOM that is already rendered? E.g the menu.</li>
  <li>Qwik has lazy-loading right out of the box! It just works and it works awesome! Why not use it for routing, too?</li>
</ul>

<h4 id="architecture">Architecture</h4>

<p>A router outlet is basically a component that will render a page in some kind of placeholder: the DOM of the entire page stays the same, but
what’s inside the router outlet gets updated. Router outlets can be quite powerful, especially if you can nest them like we can with the Angular router.
The routing system I wrote does not support multiple nested router outlets yet, but when we have multiple router outlets we can use them to 
optimise our architecture. We could attach a dialog to a route so we can close that dialog by clicking the native browser Back button.
We don’t have to keep state of that dialog, we just use the router outlet to render a component and destroy it when it needs to be destroyed.</p>

<h4 id="eventing">Eventing</h4>

<p>When we have SPA-routing, it’s nice to be notified when something in the URL changes.
Let’s pretend we are in a user management page with search functionality, and we want to make the search query bookmarkable. 
In that case when the user types ‘Brecht’ we want the URL to change to <code class="language-plaintext highlighter-rouge">/users/search?q=Brecht</code> so we can bookmark it.
We don’t want to refresh the entire page every time the user types a character, right? That would result in cursor issues with the search input. Think about debouncing as well…
We want to get notified when that specific <code class="language-plaintext highlighter-rouge">q</code> parameter changes. When it does, we perform an XHR call, and on success we rerender part of the page
with the results. You know what’s even more awesome? If we do have a full refresh of the page, we get the exact same result rendered on
the server, because that’s how awesome Qwik is.</p>

<h2 id="writing-a-spa-router-for-qwik">Writing a SPA-router for Qwik</h2>

<p>This version of the router is very early stage and could use polishing, but the principles are there. So let’s go through the code together.</p>

<h3 id="the-config">The config</h3>

<p>This is where it all starts, we need to create a config file that maps paths to components. A path can contain params.
Like Angular and Nest, we can use the <code class="language-plaintext highlighter-rouge">:</code> syntax to define params.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/routing-types.ts</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">RoutingConfigItem</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">component</span><span class="p">:</span> <span class="kr">any</span><span class="p">;</span>
    <span class="nl">path</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">RoutingConfig</span> <span class="o">=</span> <span class="nx">RoutingConfigItem</span><span class="p">[];</span>
</code></pre></div></div>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing-config.tsx</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">routingConfig</span><span class="p">:</span><span class="nx">RoutingConfig</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
        <span class="na">component</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">Home</span><span class="o">/&gt;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">component</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">Users</span><span class="o">/&gt;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users/:id</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">component</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">UserDetail</span><span class="o">/&gt;</span>
    <span class="p">}</span>
  
<span class="p">]</span>

</code></pre></div></div>
<p>The base path <code class="language-plaintext highlighter-rouge">/</code> will resolve in the home page, the <code class="language-plaintext highlighter-rouge">users</code> path to the <code class="language-plaintext highlighter-rouge">&lt;Users/&gt;</code> component, and the <code class="language-plaintext highlighter-rouge">users/:id</code> to the <code class="language-plaintext highlighter-rouge">&lt;UserDetail/&gt;</code> component.</p>

<h3 id="the-state">The state</h3>

<p>Qwik provides us with a state mechanism. We want to reflect the state in the URL to Qwik’s state.
First we need to access the URL on the server, then pass it to the <code class="language-plaintext highlighter-rouge">render</code> function.
Then we need to pass it to the <code class="language-plaintext highlighter-rouge">&lt;Root/&gt;</code> component, which passes it along to the <code class="language-plaintext highlighter-rouge">&lt;App/&gt;</code> component.
That <code class="language-plaintext highlighter-rouge">&lt;App/&gt;</code> component will initialize the router with the URL.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// entry.dev.tsx</span>
<span class="p">...</span>
<span class="nx">render</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">Root</span> <span class="nx">url</span><span class="o">=</span><span class="p">{</span><span class="dl">''</span><span class="p">}</span><span class="sr">/&gt;</span><span class="se">)</span><span class="err">;
</span></code></pre></div></div>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// entry.ssr.tsx</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">opts</span><span class="p">:</span> <span class="nx">RenderOptions</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">renderToString</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Root</span> <span class="nx">url</span><span class="o">=</span><span class="p">{</span><span class="nx">opts</span><span class="p">.</span><span class="nx">url</span> <span class="k">as</span> <span class="kr">string</span> <span class="o">||</span> <span class="dl">''</span><span class="p">}</span> <span class="sr">/&gt;, </span><span class="err">{
</span>    <span class="nx">manifest</span><span class="p">,</span>
    <span class="p">...</span><span class="nx">opts</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>

</code></pre></div></div>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// root.tsx</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">(</span><span class="nx">opts</span><span class="p">:</span> <span class="p">{</span> <span class="nl">url</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span> 
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
      <span class="p">...</span>
      <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">App</span> <span class="nx">url</span><span class="o">=</span><span class="p">{</span><span class="nx">opts</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>So, what we just did here is ensure that the <code class="language-plaintext highlighter-rouge">&lt;App/&gt;</code> component gets the URL passed to it in all cases. That’s all!
Now let’s set up the state.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/routing-state.ts</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">createContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@builder.io/qwik</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">RoutingState</span> <span class="p">{</span>
    <span class="c1">// we don't want to store `new URL()` because it is not serializable    </span>
    <span class="nl">url</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> 
    <span class="nl">segments</span><span class="p">:</span> <span class="kr">string</span><span class="p">[];</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">ROUTING</span> <span class="o">=</span> <span class="nx">createContext</span><span class="o">&lt;</span><span class="nx">RoutingState</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">Routing</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/routing.ts</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">ROUTING</span><span class="p">,</span> <span class="nx">RoutingState</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./routing-state</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">useContextProvider</span><span class="p">,</span> <span class="nx">useStore</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@builder.io/qwik</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// this one will be called by the &lt;App/&gt; component and initialize </span>
<span class="c1">// the state once for the entire lifecycle of the application</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">initializeRouter</span><span class="p">(</span><span class="nx">url</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">RoutingState</span> <span class="p">{</span>
    <span class="c1">// create a store and state</span>
    <span class="kd">const</span> <span class="nx">routingState</span> <span class="o">=</span> <span class="nx">useStore</span><span class="o">&lt;</span><span class="nx">RoutingState</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="nx">getRoutingStateByPath</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="p">);</span>

    <span class="nx">useContextProvider</span><span class="p">(</span><span class="nx">ROUTING</span><span class="p">,</span> <span class="nx">routingState</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">routingState</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// this will retrieve the routingstate by the path (the current url)</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">getRoutingStateByPath</span><span class="p">(</span><span class="nx">path</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">RoutingState</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">segments</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">segments</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// remove empty segment </span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">url</span><span class="p">:</span> <span class="nx">path</span><span class="p">,</span>
        <span class="nx">segments</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The first part of the state is done, we just have to initialize the router in the <code class="language-plaintext highlighter-rouge">&lt;App/&gt;</code> component.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// containers/app/app.tsx</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="nx">component$</span><span class="p">((</span><span class="nx">opts</span><span class="p">:</span> <span class="p">{</span> <span class="nl">url</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">initializeRouter</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">});</span>
</code></pre></div></div>

<p>All good! Now we want to actually set the router state when the route changes. There are 2 scenarios:</p>
<ul>
  <li>The user clicks on a link and wants to navigate towards a page in our app: <code class="language-plaintext highlighter-rouge">navigateTo()</code></li>
  <li>The browser navigation buttons are being used, and we want to listen to those events: <code class="language-plaintext highlighter-rouge">listenToRouteChanges()</code></li>
</ul>

<p>This is functionality we only want to run in the browser, not on the server.
We use <code class="language-plaintext highlighter-rouge">isServer</code> here, but we could also use <code class="language-plaintext highlighter-rouge">isBrowser</code>.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/routing.ts</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">isServer</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@builder.io/qwik/build</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// safely get the window object</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">getWindow</span><span class="p">():</span> <span class="nx">Window</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span> <span class="p">?</span> <span class="nb">window</span> <span class="p">:</span> <span class="kc">undefined</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">navigateTo</span><span class="p">(</span><span class="nx">path</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">routingState</span><span class="p">:</span> <span class="nx">RoutingState</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// we don't actually navigate, but push a new state to</span>
        <span class="c1">// the history object</span>
        <span class="nx">getWindow</span><span class="p">()?.</span><span class="nx">history</span><span class="p">?.</span><span class="nx">pushState</span><span class="p">({</span><span class="na">page</span><span class="p">:</span> <span class="nx">path</span><span class="p">},</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">path</span><span class="p">);</span>
        <span class="nx">setRoutingState</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">routingState</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">listenToRouteChanges</span><span class="p">(</span><span class="nx">routingState</span><span class="p">:</span> <span class="nx">RoutingState</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// when the navigation buttons are being used</span>
        <span class="c1">// we want to set the routing state</span>
        <span class="nx">getWindow</span><span class="p">()?.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">popstate</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span>
            <span class="nx">setRoutingState</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">routingState</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">setRoutingState</span><span class="p">(</span><span class="nx">path</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">routingState</span><span class="p">:</span> <span class="nx">RoutingState</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">oldUrl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">routingState</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">newUrl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">oldUrl</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">segments</span><span class="p">,</span> <span class="nx">url</span><span class="p">}</span> <span class="o">=</span> <span class="nx">getRoutingStateByPath</span><span class="p">(</span><span class="nx">newUrl</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="nx">routingState</span><span class="p">.</span><span class="nx">segments</span> <span class="o">=</span> <span class="nx">segments</span><span class="p">;</span>
    <span class="nx">routingState</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="the-router-outlet">The router outlet</h3>

<p>We have a configuration object, we provided router state, we can get that router state, and we can listen to changes that will automatically set the router state.
Besides that we also have a <code class="language-plaintext highlighter-rouge">navigateTo()</code> function that will update the <code class="language-plaintext highlighter-rouge">history</code> object instead of reloading the page.
Now we want to render the right components for the right path inside a router outlet.</p>

<p>Our app component looks like this:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// containers/app/app.tsx</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="nx">component$</span><span class="p">((</span><span class="nx">opts</span><span class="p">:</span> <span class="p">{</span> <span class="nl">url</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">routingState</span> <span class="o">=</span> <span class="nx">initializeRouter</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">section</span><span class="o">&gt;</span>
            <span class="p">...</span> <span class="nx">here</span> <span class="nx">comes</span> <span class="nx">the</span> <span class="nx">menu</span>
            <span class="o">&lt;</span><span class="nx">RouterOutlet</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="sr">/section</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Now let’s create our <code class="language-plaintext highlighter-rouge">&lt;RouterOutlet/&gt;</code> component. We have the segments of the URL, and the routing config that we can map to a component.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/router-outlet.tsx</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">component$</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@builder.io/qwik</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">ROUTING</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./routing-state</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">getMatchingConfig</span><span class="p">,}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./routing</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">routingConfig</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../routing-config</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">RouterOutlet</span> <span class="o">=</span> <span class="nx">component$</span><span class="p">(</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">routingState</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ROUTING</span><span class="p">);</span>
        <span class="c1">// render the correct component</span>
        <span class="k">return</span> <span class="nx">getMatchingConfig</span><span class="p">(</span><span class="nx">routingState</span><span class="p">.</span><span class="nx">segments</span><span class="p">,</span> <span class="nx">routingConfig</span><span class="p">)?.</span><span class="nx">component</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">getMatchingConfig()</code> function will translate the segments and config into the actual component that we want to render.
This requires some logic so that it matches not only the right component, but also takes the params into account.
Remember this piece of config?</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="nl">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">users/:id</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">component</span><span class="p">:</span> <span class="o">&lt;</span><span class="nx">UserDetail</span><span class="o">/&gt;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Let’s not dive too deeply into the following code, just know that it does the translation for us:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/routing.ts</span>
<span class="p">...</span>
<span class="c1">// go over all the RoutingConfigItem objects and if they match return the config</span>
<span class="c1">// so we know which compnent to render</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">getMatchingConfig</span><span class="p">(</span><span class="nx">segments</span><span class="p">:</span> <span class="kr">string</span><span class="p">[],</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">RoutingConfig</span><span class="p">):</span> <span class="nx">RoutingConfigItem</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">found</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">segmentsMatch</span><span class="p">(</span><span class="nx">segments</span><span class="p">,</span> <span class="nx">item</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">found</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">found</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">segmentsMatch</span><span class="p">(</span><span class="nx">pathSegments</span><span class="p">:</span> <span class="kr">string</span><span class="p">[],</span> <span class="nx">configItem</span><span class="p">:</span> <span class="nx">RoutingConfigItem</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">configItemSegments</span> <span class="o">=</span> <span class="nx">configItem</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">configItemSegments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">pathSegments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">pathSegments</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">segment</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">segment</span> <span class="o">===</span> <span class="nx">configItemSegments</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">||</span> <span class="nx">configItemSegments</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">:</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">pathSegments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now the application should work. It should render the right component on the right URL, but we are still not there yet.
Remember the <code class="language-plaintext highlighter-rouge">listenToRouteChanges()</code> function? We still need to call it. We can call that in the <code class="language-plaintext highlighter-rouge">&lt;RouterOutlet/&gt;</code> component,
but we have to make sure we only run it on the client: the <code class="language-plaintext highlighter-rouge">window</code> object does not exist on the server.
For that, Qwik provides us with the <code class="language-plaintext highlighter-rouge">useClientEffect$</code> function. The router outlet now looks like this.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">component$</span><span class="p">,</span> <span class="nx">useClientEffect$</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@builder.io/qwik</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">ROUTING</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./routing-state</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">getMatchingConfig</span><span class="p">,</span> <span class="nx">listenToRouteChanges</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./routing</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">routingConfig</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../routing-config</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">RouterOutlet</span> <span class="o">=</span> <span class="nx">component$</span><span class="p">(</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">routingState</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ROUTING</span><span class="p">);</span>
        <span class="nx">useClientEffect$</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">listenToRouteChanges</span><span class="p">(</span><span class="nx">routingState</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">getMatchingConfig</span><span class="p">(</span><span class="nx">routingState</span><span class="p">.</span><span class="nx">segments</span><span class="p">,</span> <span class="nx">routingConfig</span><span class="p">)?.</span><span class="nx">component</span>
    <span class="p">}</span>
<span class="p">);</span>

</code></pre></div></div>

<h3 id="the-link-component">The link component</h3>

<p>The traditional anchor tag <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> will completely refresh the page, which is not what we want. 
Instead, we want the <code class="language-plaintext highlighter-rouge">navigateTo()</code> function we wrote. Let’s create a <code class="language-plaintext highlighter-rouge">&lt;Link/&gt;</code> component
that renders an anchor tag, but prevents the default functionality and calls the <code class="language-plaintext highlighter-rouge">navigateTo()</code> function when the user
clicks. We use the <code class="language-plaintext highlighter-rouge">preventdefault:click</code> syntax to make sure that the actual navigation is blocked, but we still need
a <code class="language-plaintext highlighter-rouge">href</code> property for good SEO.
Then, within the <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code> tag we use a <code class="language-plaintext highlighter-rouge">&lt;Slot/&gt;</code> for content projection.
The <code class="language-plaintext highlighter-rouge">navigateTo()</code> requires the <code class="language-plaintext highlighter-rouge">routingState</code>, so we import <code class="language-plaintext highlighter-rouge">useContext</code> from Qwik to retrieve that state.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/link.tsx</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">component$</span><span class="p">,</span> <span class="nx">Slot</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@builder.io/qwik</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">navigateTo</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./routing</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">Link</span> <span class="o">=</span> <span class="nx">component$</span><span class="p">((</span><span class="nx">opts</span><span class="p">:</span> <span class="p">{</span> <span class="nl">path</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">routingState</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">ROUTING</span><span class="p">);</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">path</span><span class="p">}</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">;</span>
    <span class="c1">// check whether the link should be active or not</span>
    <span class="kd">const</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="s2">`/</span><span class="p">${</span><span class="nx">routingState</span><span class="p">.</span><span class="nx">segments</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span> <span class="o">===</span> <span class="nx">path</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">a</span>
            <span class="c1">// This will prevent the default behavior of the "click" event.</span>
            <span class="na">preventdefault</span><span class="p">:</span><span class="nx">click</span> 
            <span class="c1">// set the correct class when the link is active</span>
            <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">isActive</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">link--active</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">''</span><span class="p">}</span>
            <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="nx">path</span><span class="p">}</span> <span class="nx">onClick$</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">navigateTo</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">routingState</span><span class="p">)</span>
        <span class="p">}}</span><span class="o">&gt;&lt;</span><span class="nx">Slot</span><span class="o">/&gt;&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">});</span>

</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">.tsx</code> of the app component now looks like this:</p>
<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nt">section</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">path</span><span class="p">=</span><span class="si">{</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="si">}</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">path</span><span class="p">=</span><span class="si">{</span><span class="dl">'</span><span class="s1">/users</span><span class="dl">'</span><span class="si">}</span> <span class="p">&gt;</span>users<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">path</span><span class="p">=</span><span class="si">{</span><span class="dl">'</span><span class="s1">/users/1</span><span class="dl">'</span><span class="si">}</span><span class="p">&gt;</span>Brecht<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">RouterOutlet</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>We have successfully set up client-side SPA routing with parameter support without too much effort.
There are 2 last things missing: functionality to get path params and search params.</p>

<p>In the config we have <code class="language-plaintext highlighter-rouge">{path: 'users/:id'}</code>, and in the URL we have <code class="language-plaintext highlighter-rouge">users/1</code>, so we want
something like <code class="language-plaintext highlighter-rouge">getParams(routingState).id</code> that returns the string <code class="language-plaintext highlighter-rouge">"1"</code>.</p>

<p>In <code class="language-plaintext highlighter-rouge">routing/routing.ts</code> we add 2 more functions:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// routing/routing.tsx</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">getParams</span><span class="p">(</span><span class="nx">routingState</span><span class="p">:</span> <span class="nx">RoutingState</span><span class="p">):</span> <span class="p">{</span> <span class="p">[</span><span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">]:</span> <span class="kr">string</span> <span class="p">}</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">matchingConfig</span> <span class="o">=</span> <span class="nx">getMatchingConfig</span><span class="p">(</span><span class="nx">routingState</span><span class="p">.</span><span class="nx">segments</span><span class="p">,</span> <span class="nx">routingConfig</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">matchingConfig</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="na">segment</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">segment</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">:</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="nx">index</span><span class="p">,</span>
                    <span class="na">paramName</span><span class="p">:</span> <span class="nx">segment</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">:</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">undefined</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="o">!!</span><span class="nx">v</span><span class="p">);</span>
    <span class="kd">const</span> <span class="na">returnObj</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="na">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">]:</span> <span class="kr">string</span> <span class="p">}</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">params</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">param</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">returnObj</span><span class="p">[</span><span class="nx">param</span><span class="p">.</span><span class="nx">paramName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">routingState</span><span class="p">.</span><span class="nx">segments</span><span class="p">[</span><span class="nx">param</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="nx">returnObj</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">getSearchParams</span><span class="p">(</span><span class="nx">routingState</span><span class="p">:</span> <span class="nx">RoutingState</span><span class="p">):</span> <span class="nx">URLSearchParams</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">routingState</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">searchParams</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>That’s it!! We have a complete client-side SPA router without much code, that works with lazy loading thanks to
Qwik providing it out of the box. It was a very pleasant journey for me and I sure learned a lot.
Chances are my upcoming posts will be Qwik-related.</p>

<ul>
  <li>I learned that we have to block the traditional routing by creating a custom <code class="language-plaintext highlighter-rouge">Link</code> component that also pushes a new state to the 
history object</li>
  <li>I realized we couldn’t store the URL prototype into the state because it is not serializable and having the string is enough.</li>
  <li>I thought it was going to be hard to map a component to a route but that turned out to be quite easy and straightforward.</li>
  <li>Routers shouldn’t be that complex. We achieved a lot with a small amount of code</li>
  <li><code class="language-plaintext highlighter-rouge">useClientEffect$</code> is handy when you only want to execute something on the client.</li>
  <li>I thought it was going to be easy to work with nested router outlets but I believe there is a bigger complexity there,
but I will definitely check that out in the future</li>
</ul>

<p>You can also <a href="https://github.com/brechtbilliet/qwik-spa-routing-demo/tree/main/spa-routing">check out the source code of this demo</a>.
I hope you found it interesting as well!</p>

<p>Special thanks to the reviewers:</p>
<ul>
  <li><a href="https://twitter.com/mhevery">Miško Hevery</a></li>
  <li><a href="https://twitter.com/tigt_">Taylor Hunt</a></li>
  <li><a href="https://twitter.com/antoinepairet">Antoine Pairet</a></li>
</ul>]]></content><author><name>brechtbilliet</name></author><summary type="html"><![CDATA[The why]]></summary></entry><entry><title type="html">Reactive dumb components</title><link href="http://localhost:4000/reactive-dumb-components/" rel="alternate" type="text/html" title="Reactive dumb components" /><published>2021-05-17T00:00:00+02:00</published><updated>2021-05-17T00:00:00+02:00</updated><id>http://localhost:4000/reactive-dumb-components</id><content type="html" xml:base="http://localhost:4000/reactive-dumb-components/"><![CDATA[<h2 id="reactive-dumb-components">Reactive dumb components</h2>

<p>When we write RxJS logic inside our presentation layer we mostly wind up with reactive flows inside our smart components (container components). The reasoning behind this, is quite easy:</p>

<p>Because these smart components are the orchestration vessels of our application, they communicate with reactive asynchronous flows such as XHR-calls and state management, but also with events emitted by the dumb components.</p>

<p>That being said, dumb components may also benefit from reactive flows. Especially when the dumb component has multiple <code class="language-plaintext highlighter-rouge">@Input()</code> properties that rely on different sets of asynchronous data.
The usual way of handling these types of changes is the use of imperative <code class="language-plaintext highlighter-rouge">if else code</code> inside the <code class="language-plaintext highlighter-rouge">ngOnChanges</code> lifecycle hook.</p>

<p>Take this situation for example: We have a <code class="language-plaintext highlighter-rouge">CompanyDetail</code> component that has the responsibility to visualize a company with all its sites. 
The component has a previous and a next button to navigate between the sites, we also want to show how many sites there are and we want to show the name and address of every specific site.
The <code class="language-plaintext highlighter-rouge">sites</code> <code class="language-plaintext highlighter-rouge">@Input()</code> property is asynchronous because it is dependant on an XHR request and the <code class="language-plaintext highlighter-rouge">currentSiteId</code> <code class="language-plaintext highlighter-rouge">@Input()</code> property is asynchronous because it is dependant on the router params which is an observable behind the scenes and will change over time when the user is navigating between the different sites of a company.</p>

<p>For this component to properly work we have to make sure that the <code class="language-plaintext highlighter-rouge">sites</code> property has a value at the right time and the <code class="language-plaintext highlighter-rouge">currentSiteId</code> also has a value at the right time, we can already imagine racing conditions etc.
The component is also responsibile to calculate whether the previous button and next button are disabled or not. When these buttons are clicked, it also has to calculate the next or previous siteId to emit that value to its smart component.</p>

<p>Here we can see the app inside this <a href="https://stackblitz.com/edit/reactive-dumb-components?file=src%2Fapp%2Fcontainers%2Fcompany%2Fcompany.component.ts">Stackblitz example</a></p>

<p>This is the smart component that will use the <code class="language-plaintext highlighter-rouge">app-company-detail</code> as a dumb component.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app-company</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
    &lt;app-company-detail
      [currentSiteId]="currentSiteId$ | async"
      [sites]="sites$ | async"
      (siteChanged)="siteChanged($event)"
    &gt;&lt;/app-company-detail&gt;
  `</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./company.component.css</span><span class="dl">'</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CompanyComponent</span> <span class="p">{</span>
  <span class="c1">// fetch the sites</span>
  <span class="nx">sites$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sitesService</span><span class="p">.</span><span class="nx">getSites</span><span class="p">();</span>
  <span class="c1">// get the asynchronous siteId from the router params</span>
  <span class="nx">currentSiteId$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">activatedRoute</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">siteId</span><span class="p">));</span>

  <span class="c1">// the dumb app-company-detail component is responsible</span>
  <span class="c1">// to calculate the siteId that we need to go to</span>
  <span class="nx">siteChanged</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">navigate</span><span class="p">([</span><span class="nx">id</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="nx">sitesService</span><span class="p">:</span> <span class="nx">SitesService</span><span class="p">,</span>
    <span class="k">private</span> <span class="nx">router</span><span class="p">:</span> <span class="nx">Router</span><span class="p">,</span>
    <span class="k">private</span> <span class="nx">activatedRoute</span><span class="p">:</span> <span class="nx">ActivatedRoute</span>
  <span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The imperative implementation of the dumb component looks like this:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app-company-detail</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
    &lt;button [disabled]="previousDisabled" (click)="previousClicked()"&gt;
      Previous site
    &lt;/button&gt;
    &lt;button [disabled]="nextDisabled" (click)="nextClicked()"&gt;
      Next site
    &lt;/button&gt;
     / 
    &lt;h2&gt;&lt;/h2&gt;
    &lt;p&gt;Address: &lt;/p&gt;
  `</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./company-detail.component.css</span><span class="dl">'</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CompanyDetailComponent</span> <span class="k">implements</span> <span class="nx">OnChanges</span><span class="p">{</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">currentSiteId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">sites</span><span class="p">:</span> <span class="kr">any</span><span class="p">[];</span>
  <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">siteChanged</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="c1">// we need to keep track of 5 different local properties</span>
  <span class="c1">// and calculate and set their values at the right time</span>
  <span class="nx">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nl">previousDisabled</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">nextDisabled</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="nl">currentSite</span><span class="p">:</span> <span class="kr">any</span><span class="p">;</span>
  <span class="nl">currentSiteNumber</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="nx">ngOnChanges</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="c1">// this can become complex really fast</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentSiteId</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites</span><span class="p">?.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites</span><span class="p">?.</span><span class="nx">map</span><span class="p">(</span><span class="nx">site</span> <span class="o">=&gt;</span> <span class="nx">site</span><span class="p">?.</span><span class="nx">id</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentSiteId</span><span class="p">);</span>    
      <span class="k">this</span><span class="p">.</span><span class="nx">currentSite</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentSiteNumber</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">previousDisabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">nextDisabled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites</span><span class="p">?.</span><span class="nx">length</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">previousClicked</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">siteChanged</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sites</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>    
  <span class="p">}</span>

  <span class="nx">nextClicked</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">siteChanged</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sites</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>    
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can see that all the calculation is happening inside the ngOnChanges.
Although this solution is perfectly fine, there is a more reactive way of approaching this. For this specific example it could be overkill but it might teach you how to tackle more complex situations when tackling <code class="language-plaintext highlighter-rouge">@Input()</code> changes.</p>

<p>Think about a complex calendar view that has to do a bunch of calculations based on dozens of <code class="language-plaintext highlighter-rouge">@Input()</code> properties for instance, where a bunch of them are happening synchronous and there are async properties depending on other async properties.
Think about <code class="language-plaintext highlighter-rouge">@Input()</code> components that are useless unless other <code class="language-plaintext highlighter-rouge">@Input()</code> components have their values. Or what if you like to combine the <code class="language-plaintext highlighter-rouge">@Input()</code> properties with other async objects inside the dumb component. In the following example every piece of code inside this component is a stream. The first thing we want to do is create observables from the <code class="language-plaintext highlighter-rouge">@Input()</code> properties. I like to use this approach when multiple <code class="language-plaintext highlighter-rouge">@Input()</code> properties need eachother to compute a specific value.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">CompanyDetailComponent</span><span class="p">{</span>
  <span class="c1">// input state subjects</span>
  <span class="k">private</span> <span class="nx">currentSiteId$$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReplaySubject</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">private</span> <span class="nx">sites$$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReplaySubject</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

  <span class="c1">// input stream setters</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="kd">set</span> <span class="nx">currentSiteId</span><span class="p">(</span><span class="nx">v</span><span class="p">:</span> <span class="kr">string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">){</span> <span class="c1">// we don't care about null values in this case</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentSiteId$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="kd">set</span> <span class="nx">sites</span><span class="p">(</span><span class="nx">v</span><span class="p">:</span> <span class="kr">any</span><span class="p">[]){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">){</span> <span class="c1">// we don't care about null values in this case</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p><em>Note: We use the <code class="language-plaintext highlighter-rouge">$$</code> suffix so we can see the observable is a <code class="language-plaintext highlighter-rouge">Subject</code>.</em></p>

<p>We have now created observables from these <code class="language-plaintext highlighter-rouge">@Input()</code> properties. I have created the library <a href="https://www.npmjs.com/package/ngx-reactivetoolkit">ngx-reactivetoolkit</a> to make this even easier. We can see an example on how this cleans up the code right below:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">CompanyDetailComponent</span><span class="p">{</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="nx">currentSiteId</span><span class="p">:</span> <span class="kr">string</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span>  <span class="nx">sites</span><span class="p">:</span> <span class="kr">any</span><span class="p">[]</span>
  <span class="p">@</span><span class="nd">Changes</span><span class="p">(</span><span class="dl">'</span><span class="s1">currentSiteId</span><span class="dl">'</span><span class="p">)</span> <span class="nx">currentSiteId$</span><span class="p">;</span>
  <span class="p">@</span><span class="nd">Changes</span><span class="p">(</span><span class="dl">'</span><span class="s1">sites</span><span class="dl">'</span><span class="p">)</span> <span class="nx">sites$</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For this article we will continue with the native approach but be sure to check it out if you find the time. The toolkit might also gave some other good stuff that could help you.</p>

<p>Moving on… Remember that we mentioned that everything could be a stream? This also means our template events can be linked to streams.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">[disabled]=</span><span class="s">"previousDisabled$|async"</span> <span class="na">(click)=</span><span class="s">"previousClicked()"</span><span class="nt">&gt;</span>
  Previous site
<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">[disabled]=</span><span class="s">"nextDisabled$|async"</span> <span class="na">(click)=</span><span class="s">"nextClicked()"</span><span class="nt">&gt;</span>
  Next site
<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">// this will be used to communicate with the siteChanged @Output()</span>
  <span class="k">private</span> <span class="nx">nav$$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="nx">previousClicked</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nav$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// decrement</span>
  <span class="p">}</span>
  
  <span class="nx">nextClicked</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nav$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// increment</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>The next thing that we want to do is determine the presentation streams and the Output streams. For the presentation streams we can simply have a look at the template:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">[disabled]=</span><span class="s">"previousDisabled$|async"</span> <span class="na">(click)=</span><span class="s">"previousClicked()"</span><span class="nt">&gt;</span>
  Previous site
<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">[disabled]=</span><span class="s">"nextDisabled$|async"</span> <span class="na">(click)=</span><span class="s">"nextClicked()"</span><span class="nt">&gt;</span>
  Next site
<span class="nt">&lt;/button&gt;</span>
/ 
<span class="nt">&lt;ng-container</span> <span class="na">*ngIf=</span><span class="s">"currentSite$|async as currentSite"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/ng-container&gt;</span>

</code></pre></div></div>

<p>When looking at this template we can easily determine the presentation streams. These are all the streams that use an <code class="language-plaintext highlighter-rouge">async</code> pipe.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">previousDisabled$</code></li>
  <li><code class="language-plaintext highlighter-rouge">nextDisabled$</code></li>
  <li><code class="language-plaintext highlighter-rouge">currentSiteNumber$</code></li>
  <li><code class="language-plaintext highlighter-rouge">totalSites$</code></li>
  <li><code class="language-plaintext highlighter-rouge">currentSite$</code></li>
</ul>

<p>The only <code class="language-plaintext highlighter-rouge">@Output()</code> stream for this template is for the <code class="language-plaintext highlighter-rouge">siteChanged</code> <code class="language-plaintext highlighter-rouge">@Output()</code>. Did you know an <code class="language-plaintext highlighter-rouge">EventEmitter</code> is an observable behind the scenes? Well, it is and we can replace the <code class="language-plaintext highlighter-rouge">EventEmitter</code> with any kind of observable.</p>

<p>This means that this code:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">siteChanged</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">();</span>
</code></pre></div></div>

<p>can be refactored to:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">siteChanged</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">siteChanged$</span><span class="p">;</span>
</code></pre></div></div>

<p>Again, for this example the solution might be personal preference but when the flows become more complex we believe this approach can really shine! Think about a search component that looks like this…</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">search$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">searchControl</span><span class="p">.</span><span class="nx">valueChanges$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">debounceTime</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="nx">distinctUntilChanged</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This can become very powerful very fast!</p>

<p>The next thing that we want to do is calculate intermediate private streams. If you don’t know what we mean with that, please check out the article on the <a href="https://blog.strongbrew.io/the-sip-principle/">SIP principle</a>. We use these intermediate streams to calculate the presentation streams, which are the streams that we will use in our template, and in the <code class="language-plaintext highlighter-rouge">@Output()</code> streams</p>

<p>The <code class="language-plaintext highlighter-rouge">currentIndex$</code> stream and the <code class="language-plaintext highlighter-rouge">indexWithSites$</code> stream are streams that are being used to calculate the presentationstreams. The <code class="language-plaintext highlighter-rouge">siteChanged$</code> stream will be used by the <code class="language-plaintext highlighter-rouge">siteChanged</code> <code class="language-plaintext highlighter-rouge">@Output()</code> property later on
We can see the calculation in this example:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// intermediate streams</span>
<span class="c1">// the current index, calculated by the current site id and the sites</span>
<span class="k">private</span> <span class="nx">currentIndex$</span> <span class="o">=</span> <span class="nx">combineLatest</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">currentSiteId$$</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">map</span><span class="p">(([</span><span class="nx">currentSiteId</span><span class="p">,</span> <span class="nx">sites</span><span class="p">])</span> <span class="o">=&gt;</span> 
      <span class="nx">sites</span><span class="p">?.</span><span class="nx">map</span><span class="p">(</span><span class="nx">site</span> <span class="o">=&gt;</span> <span class="nx">site</span><span class="p">?.</span><span class="nx">id</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">currentSiteId</span><span class="p">)</span>    
    <span class="p">)</span>
  <span class="p">);</span>

<span class="c1">// an array that always contains the currentIndex and all the sites</span>
<span class="k">private</span> <span class="nx">indexWithSites$</span> <span class="o">=</span> <span class="nx">combineLatest</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">currentIndex$</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">]);</span>

<span class="c1">// every time the nav button is clicked, we need to calculate the id that</span>
<span class="c1">// needs to be emitted to the siteChanged @Output()</span>
<span class="k">private</span> <span class="nx">siteChanged$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nav$$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
  <span class="nx">withLatestFrom</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex$</span><span class="p">),</span>
  <span class="nx">map</span><span class="p">(([</span><span class="nx">navigationIndex</span><span class="p">,</span> <span class="nx">sites</span><span class="p">,</span> <span class="nx">currentIndex</span><span class="p">])</span> <span class="o">=&gt;</span> 
    <span class="nx">sites</span><span class="p">[</span><span class="nx">currentIndex</span> <span class="o">+</span> <span class="nx">navigationIndex</span><span class="p">]?.</span><span class="nx">id</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Now we can start by implementing the  presentation streams and the <code class="language-plaintext highlighter-rouge">@Output()</code> stream.
In the code snippet below we can see the complete code: You can also check the <a href="https://stackblitz.com/edit/reactive-dumb-components-reactive?file=src/app/components/company-detail/company-detail.component.ts">StackBlitz example</a></p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app-company-detail</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
    &lt;button [disabled]="previousDisabled$|async" (click)="previousClicked()"&gt;
      Previous site
    &lt;/button&gt;
    &lt;button [disabled]="nextDisabled$|async" (click)="nextClicked()"&gt;
      Next site
    &lt;/button&gt;
    / 
    &lt;ng-container *ngIf="currentSite$|async as currentSite"&gt;
      &lt;h2&gt;&lt;/h2&gt;
      &lt;p&gt;Address: &lt;/p&gt;
    &lt;/ng-container&gt;

  `</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./company-detail.component.css</span><span class="dl">'</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CompanyDetailComponent</span><span class="p">{</span>
  <span class="c1">// local state subjects and input state subjects</span>
  <span class="k">private</span> <span class="nx">nav$$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">private</span> <span class="nx">currentSiteId$$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReplaySubject</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">private</span> <span class="nx">sites$$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReplaySubject</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

  <span class="c1">// input stream setters</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="kd">set</span> <span class="nx">currentSiteId</span><span class="p">(</span><span class="nx">v</span><span class="p">:</span> <span class="kr">string</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentSiteId$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="p">@</span><span class="nd">Input</span><span class="p">()</span> <span class="kd">set</span> <span class="nx">sites</span><span class="p">(</span><span class="nx">v</span><span class="p">:</span> <span class="kr">any</span><span class="p">[]){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// intermediate streams</span>
  <span class="k">private</span> <span class="nx">currentIndex$</span> <span class="o">=</span> <span class="nx">combineLatest</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">currentSiteId$$</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">map</span><span class="p">(([</span><span class="nx">currentSiteId</span><span class="p">,</span> <span class="nx">sites</span><span class="p">])</span> <span class="o">=&gt;</span> 
        <span class="nx">sites</span><span class="p">?.</span><span class="nx">map</span><span class="p">(</span><span class="nx">site</span> <span class="o">=&gt;</span> <span class="nx">site</span><span class="p">?.</span><span class="nx">id</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">currentSiteId</span><span class="p">)</span>    
      <span class="p">)</span>
    <span class="p">);</span>
  <span class="k">private</span> <span class="nx">indexWithSites$</span> <span class="o">=</span> <span class="nx">combineLatest</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">currentIndex$</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">]);</span>

  <span class="k">private</span> <span class="nx">siteChanged$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nav$$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">withLatestFrom</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex$</span><span class="p">),</span>
    <span class="nx">map</span><span class="p">(([</span><span class="nx">navigationIndex</span><span class="p">,</span> <span class="nx">sites</span><span class="p">,</span> <span class="nx">currentIndex</span><span class="p">])</span> <span class="o">=&gt;</span> 
     <span class="nx">sites</span><span class="p">[</span><span class="nx">currentIndex</span> <span class="o">+</span> <span class="nx">navigationIndex</span><span class="p">]?.</span><span class="nx">id</span>
    <span class="p">)</span>
  <span class="p">)</span>

  <span class="c1">// output streams and presentational streams</span>
  <span class="p">@</span><span class="nd">Output</span><span class="p">()</span> <span class="nx">siteChanged</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">siteChanged$</span><span class="p">;</span>
  <span class="nx">previousDisabled$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">map</span><span class="p">(</span><span class="nx">currentIndex</span> <span class="o">=&gt;</span><span class="nx">currentIndex</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="nx">nextDisabled$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexWithSites$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">map</span><span class="p">(([</span><span class="nx">currentIndex</span><span class="p">,</span> <span class="nx">sites</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">currentIndex</span> <span class="o">===</span> <span class="nx">sites</span><span class="p">?.</span><span class="nx">length</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="nx">currentSite$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexWithSites$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">map</span><span class="p">(([</span><span class="nx">currentIndex</span><span class="p">,</span> <span class="nx">sites</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="nx">sites</span><span class="p">[</span><span class="nx">currentIndex</span><span class="p">])</span>
  <span class="p">)</span>
  <span class="nx">totalSites$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sites$$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">map</span><span class="p">(</span><span class="nx">sites</span> <span class="o">=&gt;</span> <span class="nx">sites</span><span class="p">?.</span><span class="nx">length</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="nx">currentSiteNumber$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">map</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="nx">previousClicked</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nav$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>    
  <span class="p">}</span>
  
  <span class="nx">nextClicked</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nav$$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>    
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>We can make components completely reactive if we want to by:</p>
<ul>
  <li>Binding other observables to <code class="language-plaintext highlighter-rouge">@Output()</code> properties</li>
  <li>Using setters to populate <code class="language-plaintext highlighter-rouge">@Input()</code> properties</li>
  <li>We can use <code class="language-plaintext highlighter-rouge">ngx-reactivetoolkit</code> to make the code cleaner</li>
</ul>

<p>For simple component this can be seen as overkill, but it could definitely help when dumb components become more complex and rely of different streams of data that are happening asynchronously.</p>]]></content><author><name>brechtbilliet</name></author><category term="Rxjs" /><category term="Rxjs" /><summary type="html"><![CDATA[How to make dumb components reactive without imperative ngOnChanges programming]]></summary></entry><entry><title type="html">How covid affected StrongBrew</title><link href="http://localhost:4000/how-covid-affected-strongbrew/" rel="alternate" type="text/html" title="How covid affected StrongBrew" /><published>2020-11-03T00:00:00+01:00</published><updated>2020-11-03T00:00:00+01:00</updated><id>http://localhost:4000/how-covid-affected-strongbrew</id><content type="html" xml:base="http://localhost:4000/how-covid-affected-strongbrew/"><![CDATA[<h2 id="covid">Covid</h2>

<p>These are challenging times… Harsh times for people and companies. Even for some companies it results in fatal decisions.</p>

<p>Unfortunately we were impacted by COVID as well, as we haven’t earned a single dime since March 2020.
If we take this painful aspect into consideration in combination with the fact that Kwinten is pursuing a new job at Stackblitz we decided to stop the legal entity StrongBrew VOF. StrongBrew VOF is no more… I (Brecht) personally want to thank Kwinten for this awesome adventure and I hope we can work together once again in the future.</p>

<p>That being said… I will continue all StrongBrew activities except the trainings. The brews that we have given, both locally and internationally will not be updated anymore, nor will they be given in companies. We want to thank all of you for following our trainings, reading our content and trusting us with important problems.</p>

<h2 id="blog">Blog</h2>

<p>Most articles of the blog are more than a year old. My goal is to pump new life into the blog and help you all with technical content and personal experience. I still do Angular/RxJS/Architecture on a full time basis and recently started freelancing for a new awesome startup called <a href="https://www.rosa.be/">rosa</a>.</p>

<p>The techstack we use there is:</p>
<ul>
  <li>Angular</li>
  <li>Nx</li>
  <li>Typescript</li>
  <li>RxJS</li>
  <li>Nest.js</li>
  <li>a bunch other cool technologies</li>
</ul>

<h2 id="what-can-i-still-do-for-your-company-remotely">What can I still do for your company (remotely)</h2>

<p>In these challenging times we still believe your company can benefit from the services of StrongBrew.
The services listed below is something that I still do 1/5th of my time:</p>

<ul>
  <li>Code reviews</li>
  <li>Pair programming sessions</li>
  <li>Help you with the interview process of your possible employees</li>
  <li>Help you with kickstarting a new project</li>
  <li>Overal architectural support</li>
  <li>Tackle very specific problems</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>Unfortunately our company has died a slow death, but you will be hearing more of StrongBrew in the near future. Stay safe! Stay healthy! And if you have questions don’t hesitate to reach out.
Cheers! Brecht.</p>]]></content><author><name>brechtbilliet</name></author><category term="Covid" /><category term="COVID" /><summary type="html"><![CDATA[What is the future of StrongBrew? How were we impacted by COVID?]]></summary></entry><entry><title type="html">Managing state in Angular</title><link href="http://localhost:4000/managing-state-in-angular/" rel="alternate" type="text/html" title="Managing state in Angular" /><published>2019-07-29T00:00:00+02:00</published><updated>2019-07-29T00:00:00+02:00</updated><id>http://localhost:4000/managing-state-in-angular</id><content type="html" xml:base="http://localhost:4000/managing-state-in-angular/"><![CDATA[<h2 id="about-this-article">About this article</h2>

<p>When we create single-page-applications, there is no way around it. Sooner or later we are going to be facing state. There are a lot of solutions out there to manage that state and together with those solutions there are a lot of opinions.
Especially when working with experienced developers, there opinions get stronger and often result in interesting discussions.</p>

<p>This article is not about which libraries to use, but to learn about what state is and how we can reason about it. The examples are all written in Angular, however the approaches are not specific to Angular.</p>

<p>In this article we will learn about the different kind of state types within our application, and where that state might live.</p>

<h2 id="what-is-state">What is state?</h2>

<p>State is basically everything that will define the UI that our user will be using.
State could be whether a button should be visible or not, it could be the result of that button click and it could also be an <code class="language-plaintext highlighter-rouge">Array</code> of users that is coming from an API.
State can live in different places throughout our entire application. Some state is very specific to a certain component where other state might be shared in different parts of our application. One piece of state could be a singleton instance, where a another piece of state could share the limited lifespan of a component that can be destroyed at any time.</p>

<p>This big variety of what state could be, how long it lives and where it comes from results in complexity that we need to manage.</p>

<h2 id="what-is-state-management">What is state management?</h2>

<p>State management is the concept of adding, updating, removing and reading pieces of state in an application. When we have deeply nested data structures and we want to update a specific part deep down in the tree, it might become complex. In that case we have state management libraries that contain a <code class="language-plaintext highlighter-rouge">Store</code> which helps us with state management to get rid of that complexity. A quick note, we have to be careful that these libraries don’t add complexity by overusing them.</p>

<h2 id="reactive-state">Reactive state</h2>

<p>Combining state management together with reactive programming can be a really nice way to develop single-page-applications. Whether our focus lies on Angular, Vue or React, combining these two principles  will result in more predictable applications.</p>

<p>Now what has state to do with reactive programming?
A piece of state can change over time, so in a way we are waiting for new state changes. That makes it asynchronous.</p>

<p>Let’s take this example for instance:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// false------true-----false---true...</span>
<span class="nx">sidebarCollapsed$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">sidebarCollapsed$</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">sidebarCollapsed$</code> stream starts out with <code class="language-plaintext highlighter-rouge">false</code>, later on it becomes <code class="language-plaintext highlighter-rouge">true</code> and so on. This stream keeps on living. In Angular this state can be consumed with the <a href="https://angular.io/api/common/AsyncPipe">async pipe</a> as easy as:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;my-awesome-sidebar</span> <span class="na">*ngIf=</span><span class="s">"sidebarCollapsed$|async"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/my-awesome-sidebar&gt;</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">async</code> pipe will subscribe to the <code class="language-plaintext highlighter-rouge">sidebarCollapsed$</code> pass it to the component, mark it for check and will automatically unsubscribe when the component gets destroyed.
Keeping state in an observer pattern is nice because we can subscribe to the changes. Oh, and did I mention it plays super nice with Angular?</p>

<p>We can either use a <code class="language-plaintext highlighter-rouge">BehaviorSubject</code> or state management frameworks that support Observables. Here are some really great ones with Observable support:</p>

<ul>
  <li><a href="https://ngrx.io">Ngrx</a></li>
  <li><a href="https://netbasal.gitbook.io/akita/">Akita</a></li>
  <li><a href="https://github.com/ngxs/store">Ngxs</a></li>
</ul>

<h2 id="immutability-and-unidirectional-data-flow">Immutability and Unidirectional data flow</h2>

<p>Before we dive deeper in state, there are 2 important principles that we should follow when managing state.
The first principle is <strong>immutability</strong>, which means that we should never mutate data directly without creating a new reference of that object.
If we mutate data directly, our application becomes unpredictable and it’s really hard to trace bugs.
When we work in an immutable fashion we can also take advantage of performance strategies like the <a href="https://netbasal.com/a-comprehensive-guide-to-angular-onpush-change-detection-strategy-5bac493074a4">ChangeDetection.OnPush</a> from Angular or React its <a href="https://reactjs.org/docs/react-api.html#reactpurecomponent">PureComponent</a>.</p>

<p>When we use typescript we can enforce the typescript compiler to complain when we mutate data</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">readonly</span> <span class="na">bar</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> 
    <span class="k">readonly</span> <span class="na">baz</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span> 
<span class="p">}</span>
<span class="kd">let</span> <span class="nx">first</span> <span class="o">=</span> <span class="p">{</span><span class="na">bar</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="na">baz</span><span class="p">:</span> <span class="mi">1</span><span class="p">};</span>
<span class="nx">first</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">test2</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// compilation error</span>
<span class="nx">first</span> <span class="o">=</span> <span class="p">{...</span><span class="nx">first</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test2</span><span class="dl">'</span><span class="p">};</span> <span class="c1">// success</span>
</code></pre></div></div>

<p>In the previous example we have overwritten the <code class="language-plaintext highlighter-rouge">first</code> instance with an entire new instance that has an updated <code class="language-plaintext highlighter-rouge">bar</code> property.</p>

<p>Arrays can be handled like this:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Brecht</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Kwinten</span><span class="dl">'</span><span class="p">];</span>
<span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">John</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// BAD: arr is mutated</span>
<span class="nx">arr</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">arr</span><span class="p">,</span> <span class="dl">'</span><span class="s1">John</span><span class="dl">'</span><span class="p">];</span> <span class="c1">// Good, arr gets new reference</span>
</code></pre></div></div>
<p>the <code class="language-plaintext highlighter-rouge">Array</code> prototype also has some great helper functions that we can use to enforce immutability like <code class="language-plaintext highlighter-rouge">map()</code> and <code class="language-plaintext highlighter-rouge">filter()</code> but this is not in scope for this article.</p>

<p>The second principle is <strong>Unidirectional data flow</strong>.
In a nutshell, this means that we should never use two-way data binding on state. It is the absolute owner of that specific piece of state that is in charge of updating it (immutable of course).</p>

<p>Both of these principles are highly enforced by the <a href="https://redux.js.org/">Redux</a> pattern.</p>

<h2 id="what-kind-of-states-are-there">What kind of states are there?</h2>

<h3 id="router-state">Router state</h3>

<p>Often forgotten, but one of the most important pieces of state a web application can have. Putting state in the route gives us the following advantages:</p>

<ul>
  <li>We can use the browser navigation buttons</li>
  <li>We can bookmark the state</li>
  <li>We can can copy and paste the url with the state to other users</li>
  <li>We don’t have to manage it, it’s always there in the route</li>
</ul>

<p><strong>Tip</strong>: Instead of handling modals with a <code class="language-plaintext highlighter-rouge">userDetailModalVisible</code> property, why not enjoy all the benefits mentioned above and bind it to a <code class="language-plaintext highlighter-rouge">users/:userId</code> route?
Using a child <code class="language-plaintext highlighter-rouge">router-outlet</code> in Angular makes this a piece of cake as we can see in this snippet.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table&gt;</span>
<span class="c">&lt;!--contains users --&gt;</span>
<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;router-outlet&gt;</span>
<span class="c">&lt;!-- user detail modal rendered in here --&gt;</span>
<span class="nt">&lt;/router-outlet&gt;</span>
</code></pre></div></div>

<h3 id="component-state">Component state</h3>

<p>Every component could contain state. That state could be shared with its dumb components or could be used in the component itself.
Eg: When an <code class="language-plaintext highlighter-rouge">ItemComponent</code> has a property <code class="language-plaintext highlighter-rouge">selectedItems</code> which is an array of ids, and that array is never used in other components (that aren’t children of that component), we can consider it component state. 
It belongs to that component, therefore the component should be responsible for it. Child components can consume that state but should <em>never mutate it</em>. Those components can notify their parent that is responsible for it, which could update it in an immutable way. For more information about smart and dumb components <a href="https://blog.strongbrew.io/components-demystified/#smart-vs-dumb-components">look here</a>.</p>

<p>Personally, I try to avoid state management frameworks for managing component state because it’s the responsibility of that component to manage that state.
There are however good reasons to use state management frameworks to manage component state:</p>

<ul>
  <li>When the state management is very complex</li>
  <li>If we want to do <a href="https://blog.strongbrew.io/Cancellable-optimistic-updates-in-Angular2-and-Redux/">optimistic updates</a></li>
  <li>If we want to use it for <a href="https://blog.strongbrew.io/How-we-made-our-app-real-time-in-6-lines-of-code/">realtime stuff</a></li>
</ul>

<p>If the state management of the component becomes a bit too complex and we don’t want to use a state management framework just yet, we could use a state reducer in the component itself.</p>

<h3 id="persisted-state">Persisted state</h3>

<p>Persisted state, is state that is being remembered when the user navigates between different pages. This could be whether a sidebar was collapsed or not, or when the user returns to a grid with a lot of filters and he wants them to be remembered and reapplied when he returns.
Another example is a wizard with different steps, and every step needs to be persisted so the user can navigate back and forth and the last page is a result of all these steps.</p>

<p>Persisted state is the type of state where we typically use a state management framework for, that being said, if we don’t want to rely on an external dependency we can also manage it in a Angular <code class="language-plaintext highlighter-rouge">service</code> which can be a singleton that is shared throughout the entire application. If that <code class="language-plaintext highlighter-rouge">service</code> becomes too complex or there is a lot of state to manage, I would consider to put that state into a state management framework.</p>

<h3 id="shared-state">Shared state</h3>

<p>When we are talking about shared state, we are talking about state that needs to be shared between different parts of our application. State that is being shared throughout different smart components. This means that the instance of this piece of state should live on a higher level, than the components that want to consume it.</p>

<p>Shared state can be managed in a state management framework like <a href="https://redux.js.org/">Redux</a>, <a href="https://ngrx.io">Ngrx</a>, <a href="https://netbasal.gitbook.io/akita/">Akita</a>, <a href="https://github.com/ngxs/store">Ngxs</a> and so on, but if that state is small and simple we can also manage it manually.
Let’s say that we want an <code class="language-plaintext highlighter-rouge">Observable</code> of an <code class="language-plaintext highlighter-rouge">Array</code> of countries that we need to share throughout the entire application. In Angular we could have a <code class="language-plaintext highlighter-rouge">CountryService</code> that fetches the countries from the API once, and then shares it throughout the entire application. 
For that we can use the <code class="language-plaintext highlighter-rouge">shareReplay</code> operator from RxJS.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">CountryService</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">countries$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">countries</span><span class="dl">'</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">shareReplay</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Simple right, one line of code?! For this we don’t <strong>need</strong> a state management framework, although it can also have its benefits.
Some developers like to keep all their master data in a <code class="language-plaintext highlighter-rouge">Redux</code> store, and that’s fine. Just know that we don’t have to.
I like to develop by the <strong>KISS</strong> principle (<strong>K</strong>eep <strong>I</strong>t <strong>S</strong>imple <strong>S</strong>tupid) as much as possible, so I favor this approach many times.
Think about the amount of lines of code we saved by this approach.
Beware that every line of code we write, not only needs to be written but also maintained.</p>

<h2 id="which-state-needs-to-be-managed">Which state needs to be managed?</h2>

<p>Now that we know what state is, we have to ask ourselves which state needs to be managed, and where do we manage that state? In a component, singleton service or a framework (Store)?</p>

<p>This is the part where the strong opinions surface.
I would suggest to use what works for you and your team and really think about, but here are  <strong>my personal opinionated</strong> guidelines:</p>

<ul>
  <li>I try to avoid state management frameworks where possible. RxJS already leverages us with a lot already and I like to think <strong>KISS</strong>.</li>
  <li>I try to avoid using state management frameworks to communicate with different parts in my application, I believe state is unrelated to communication.</li>
  <li>When my component can handle the state and it’s not too complex, I let my component in charge of managing that state.</li>
  <li>Master data like countries are exposed in a service which uses the <code class="language-plaintext highlighter-rouge">shareReplay</code> operator.</li>
  <li>I don’t put the result of a <code class="language-plaintext highlighter-rouge">getById</code> API call into a store if there is no one consuming that state except for the component requesting it</li>
  <li>I use a facade between my smart components and my store/services to make refactoring easier in the future.</li>
</ul>

<p>However, there is also a popular opinion out there to put literally everything in the store which has the following advantages:</p>

<ul>
  <li>We can see the flow of the code in devtools</li>
  <li>Consistent pattern</li>
  <li>We can leverage selectors with memoization</li>
  <li>Easier for realtime applications</li>
  <li>Optimistic updates are easier</li>
</ul>

<p>However, there are a few downsides as well:</p>

<ul>
  <li>A gigantic amount of bloat code: Bigger bundle size, more maintenance and dev time. Eg: If we would use the complete Ngrx pattern for the <code class="language-plaintext highlighter-rouge">countries$</code> example we would have to write an: <code class="language-plaintext highlighter-rouge">action</code>, <code class="language-plaintext highlighter-rouge">actiontype</code>, <code class="language-plaintext highlighter-rouge">effect</code> and a  <code class="language-plaintext highlighter-rouge">reducer</code>.</li>
  <li>Tightly coupled to a strong dependency that is hard to get rid of in the future</li>
  <li>Generally more complex</li>
  <li>The user his screen can get out of sync with the backend</li>
  <li>Cache invalidation: if we add a <code class="language-plaintext highlighter-rouge">currentUserToEdit</code> in the store, we have to get it out when we navigate away</li>
  <li>We can’t use the <code class="language-plaintext highlighter-rouge">async</code> pipe to cancel pending XHR requests</li>
  <li>We create a distributed monolith of some sort</li>
</ul>

<h2 id="wrapping-up">Wrapping up</h2>

<p>State management is a topic surrounded with discussions and opinions. There is no right or wrong, use what works for you and your team. There are awesome libraries out there, use them if it benefits you, but at least think about it before you use them. That’s the goal of this article after all, to get everyone to start thinking about state managment rather than jumping to the first solution.</p>

<h2 id="special-thanks">Special thanks</h2>

<p>Special thanks to the awesome reviewers:</p>

<ul>
  <li><a href="https://twitter.com/tim_deschryver">Tim Deschryver</a></li>
  <li><a href="https://twitter.com/jefiozie">Jeffrey Bosch</a></li>
  <li><a href="https://twitter.com/rubverm">Ruben Vermeulen</a></li>
</ul>]]></content><author><name>brechtbilliet</name></author><category term="brechtbilliet" /><category term="architecture" /><summary type="html"><![CDATA[About this article]]></summary></entry></feed>